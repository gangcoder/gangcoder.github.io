<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2191px" height="825px" viewBox="-0.5 -0.5 2191 825" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-03-07T09:59:07.324Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.5.3 Chrome/78.0.3904.130 Electron/7.1.9 Safari/537.36&quot; etag=&quot;00KfPB_tmAdkzRhtkR7H&quot; version=&quot;12.5.3&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;MVXsBD2m_SS1NU2un3BB&quot; name=&quot;第 1 页&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-1044-155-472-26-0"><rect x="1044" y="155" width="472" height="26"/></clipPath><clipPath id="mx-clip-1044-181-472-26-0"><rect x="1044" y="181" width="472" height="26"/></clipPath><clipPath id="mx-clip-1044-207-472-26-0"><rect x="1044" y="207" width="472" height="26"/></clipPath><clipPath id="mx-clip-1044-233-472-26-0"><rect x="1044" y="233" width="472" height="26"/></clipPath><clipPath id="mx-clip-1044-259-472-26-0"><rect x="1044" y="259" width="472" height="26"/></clipPath><clipPath id="mx-clip-1564-154-212-26-0"><rect x="1564" y="154" width="212" height="26"/></clipPath><clipPath id="mx-clip-1564-180-212-26-0"><rect x="1564" y="180" width="212" height="26"/></clipPath><clipPath id="mx-clip-1564-206-212-26-0"><rect x="1564" y="206" width="212" height="26"/></clipPath><clipPath id="mx-clip-1564-232-212-26-0"><rect x="1564" y="232" width="212" height="26"/></clipPath><clipPath id="mx-clip-1564-258-212-26-0"><rect x="1564" y="258" width="212" height="26"/></clipPath></defs><g><path d="M 520 154 L 550 154 Q 560 154 560 164 L 560 174 Q 560 184 570 184 L 593.63 184" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 598.88 184 L 591.88 187.5 L 593.63 184 L 591.88 180.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="20" y="124" width="500" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 491px; height: 1px; padding-top: 154px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">disp = dispatch.NewDispatcher(alerts, routes, pipeline, ...)</div></div></div></foreignObject><text x="27" y="158" fill="#000000" font-family="source code pro" font-size="13px">disp = dispatch.NewDispatcher(alerts, routes, pipeline, ...)</text></switch></g><rect x="600" y="124" width="220" height="120" rx="18" ry="18" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 211px; height: 1px; padding-top: 184px; margin-left: 607px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>disp := &amp;Dispatcher{</div><div>    alerts:  ap,</div><div>    stage:   s,</div><div>    route:   r,</div><div>    marker:  mk,</div><div>}</div><div>return disp</div></div></div></div></foreignObject><text x="607" y="188" fill="#000000" font-family="source code pro" font-size="13px">disp := &amp;Dispatcher{...</text></switch></g><path d="M 200 314 L 253.63 314" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 258.88 314 L 251.88 317.5 L 253.63 314 L 251.88 310.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="20" y="284" width="180" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 171px; height: 1px; padding-top: 314px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">go disp.Run()</div></div></div></foreignObject><text x="27" y="318" fill="#000000" font-family="source code pro" font-size="13px">go disp.Run()</text></switch></g><path d="M 520 314 L 593.63 314" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 598.88 314 L 591.88 317.5 L 593.63 314 L 591.88 310.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="260" y="284" width="260" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 251px; height: 1px; padding-top: 314px; margin-left: 267px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">d.run(d.alerts.Subscribe())</div></div></div></foreignObject><text x="267" y="318" fill="#000000" font-family="source code pro" font-size="13px">d.run(d.alerts.Subscribe())</text></switch></g><path d="M 637.2 349 L 637.05 379 Q 637 389 647 389 L 673.63 389" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 678.88 389 L 671.88 392.5 L 673.63 389 L 671.88 385.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="279" width="400" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 391px; height: 1px; padding-top: 314px; margin-left: 607px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>alert, ok := &lt;-it.Next():</div><div>for _, r := range d.route.Match(alert.Labels) {</div><div>    d.processAlert(alert, r)</div><div>}</div></div></div></div></foreignObject><text x="607" y="318" fill="#000000" font-family="source code pro" font-size="13px">alert, ok := &lt;-it.Next():...</text></switch></g><path d="M 1080 389 L 1183.63 389" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1188.88 389 L 1181.88 392.5 L 1183.63 389 L 1181.88 385.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="680" y="359" width="400" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 391px; height: 1px; padding-top: 389px; margin-left: 687px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">processAlert(alert *types.Alert, route *Route)</div></div></div></foreignObject><text x="687" y="393" fill="#000000" font-family="source code pro" font-size="13px">processAlert(alert *types.Alert, route *Route)</text></switch></g><path d="M 1080 389 L 1100 389 Q 1110 389 1110 399 L 1110 449 Q 1110 459 1120 459 L 1183.63 459" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1188.88 459 L 1181.88 462.5 L 1183.63 459 L 1181.88 455.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1190" y="359" width="380" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 371px; height: 1px; padding-top: 389px; margin-left: 1197px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>groupLabels := getGroupLabels(alert, route)</div><div>fp := groupLabels.Fingerprint()</div><div>group, ok := d.aggrGroups[route]</div></div></div></div></foreignObject><text x="1197" y="393" fill="#000000" font-family="source code pro" font-size="13px">groupLabels := getGroupLabels(alert, route)...</text></switch></g><path d="M 1080 389 L 1100 389 Q 1110 389 1110 399 L 1110 609 Q 1110 619 1120 619 L 1183.63 619" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1188.88 619 L 1181.88 622.5 L 1183.63 619 L 1181.88 615.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1190" y="429" width="540" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 531px; height: 1px; padding-top: 459px; margin-left: 1197px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>ag = newAggrGroup(d.ctx, groupLabels, route, d.timeout, d.logger)</div><div>group[fp] = ag</div></div></div></div></foreignObject><text x="1197" y="463" fill="#000000" font-family="source code pro" font-size="13px">ag = newAggrGroup(d.ctx, groupLabels, route, d.timeout, d.logger)...</text></switch></g><path d="M 1080 389 L 1100 389 Q 1110 389 1110 399 L 1110 529 Q 1110 539 1120 539 L 1183.63 539" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1188.88 539 L 1181.88 542.5 L 1183.63 539 L 1181.88 535.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1190" y="499" width="540" height="80" rx="12" ry="12" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 531px; height: 1px; padding-top: 539px; margin-left: 1197px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>go ag.run(func(ctx context.Context, alerts ...*types.Alert) bool {</div><div>    _, _, err := d.stage.Exec(ctx, d.logger, alerts...)</div><div>    return err == nil</div><div>})</div></div></div></div></foreignObject><text x="1197" y="543" fill="#000000" font-family="source code pro" font-size="13px">go ag.run(func(ctx context.Context, alerts ...*types.Alert) bool {...</text></switch></g><path d="M 1730 539 L 1783.63 539" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1788.88 539 L 1781.88 542.5 L 1783.63 539 L 1781.88 535.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1790" y="509" width="380" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 371px; height: 1px; padding-top: 539px; margin-left: 1797px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>ag.flush(func(alerts ...*types.Alert) bool {</div><div>    return nf(ctx, alerts...)</div><div>})</div></div></div></div></foreignObject><text x="1797" y="543" fill="#000000" font-family="source code pro" font-size="13px">ag.flush(func(alerts ...*types.Alert) bool {...</text></switch></g><path d="M 1885 569 L 1885 609 Q 1885 619 1895 619 L 1918.63 619" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1923.88 619 L 1916.88 622.5 L 1918.63 619 L 1916.88 615.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1925" y="589" width="245" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 236px; height: 1px; padding-top: 619px; margin-left: 1932px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>alerts = ag.alerts.List()</div><div>notify(alertsSlice...)</div></div></div></div></foreignObject><text x="1932" y="623" fill="#000000" font-family="source code pro" font-size="13px">alerts = ag.alerts.List()...</text></switch></g><path d="M 1350 619 L 1413.63 619" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1418.88 619 L 1411.88 622.5 L 1413.63 619 L 1411.88 615.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="1190" y="589" width="160" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 151px; height: 1px; padding-top: 619px; margin-left: 1197px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ag.insert(alert)</div></div></div></foreignObject><text x="1197" y="623" fill="#000000" font-family="source code pro" font-size="13px">ag.insert(alert)</text></switch></g><rect x="1420" y="589" width="190" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 181px; height: 1px; padding-top: 619px; margin-left: 1427px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="white-space: normal">ag.alerts.Set(alert)</span></div></div></div></foreignObject><text x="1427" y="623" fill="#000000" font-family="source code pro" font-size="13px">ag.alerts.Set(alert)</text></switch></g><rect x="20" y="454" width="370" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 361px; height: 1px; padding-top: 484px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">routes := dispatch.NewRoute(conf.Route, nil)</div></div></div></foreignObject><text x="27" y="488" fill="#000000" font-family="source code pro" font-size="13px">routes := dispatch.NewRoute(conf.Route, nil)</text></switch></g><path d="M 440 694 L 465 694 Q 475 694 475 704 L 475 724 Q 475 734 485 734 L 503.63 734" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 508.88 734 L 501.88 737.5 L 503.63 734 L 501.88 730.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="20" y="664" width="420" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 411px; height: 1px; padding-top: 694px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">func (r *Route) Match(lset model.LabelSet) []*Route</div></div></div></foreignObject><text x="27" y="698" fill="#000000" font-family="source code pro" font-size="13px">func (r *Route) Match(lset model.LabelSet) []*Route</text></switch></g><path d="M 1000 314 L 1090 314 Q 1100 314 1100 324 L 1100 634 Q 1100 644 1090 644 L 240 644 Q 230 644 230 650.82 L 230 657.63" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 230 662.88 L 226.5 655.88 L 230 657.63 L 233.5 655.88 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="all"/><rect x="510" y="664" width="340" height="140" rx="21" ry="21" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 331px; height: 1px; padding-top: 734px; margin-left: 517px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>for _, cr := range r.Routes {</div><div>    matches := cr.Match(lset)</div><div>    all = append(all, matches...)</div><div>    if matches != nil &amp;&amp; !cr.Continue {</div><div>        break</div><div>    }</div><div>}</div><div>return all</div></div></div></div></foreignObject><text x="517" y="738" fill="#000000" font-family="source code pro" font-size="13px">for _, cr := range r.Routes {...</text></switch></g><path d="M 390 484 L 503.63 484" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 508.88 484 L 501.88 487.5 L 503.63 484 L 501.88 480.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 390 484 L 400 484 Q 410 484 410 494 L 410 569 Q 410 579 420 579 L 503.63 579" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 508.88 579 L 501.88 582.5 L 503.63 579 L 501.88 575.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="510" y="449" width="330" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 321px; height: 1px; padding-top: 484px; margin-left: 517px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>for ln, lv := range cr.Match {</div><div>    matchers = append(matchers, ...)</div><div>}</div></div></div></div></foreignObject><text x="517" y="488" fill="#000000" font-family="source code pro" font-size="13px">for ln, lv := range cr.Match {...</text></switch></g><rect x="510" y="529" width="240" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 231px; height: 1px; padding-top: 579px; margin-left: 517px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>route := &amp;Route{</div><div>    parent:    parent,</div><div>    RouteOpts: opts,</div><div>    Matchers:  matchers,</div><div>    Continue:  cr.Continue,</div><div>}</div></div></div></div></foreignObject><text x="517" y="583" fill="#000000" font-family="source code pro" font-size="13px">route := &amp;Route{...</text></switch></g><path d="M 1040 150 L 1040 124 L 1520 124 L 1520 150" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1040 150 L 1040 280 L 1520 280 L 1520 150" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1040 150 L 1520 150" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1046.5" y="142">Dispatcher</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1044-155-472-26-0)" font-size="13px"><text x="1045.5" y="168.5">- route: *Route</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1044-181-472-26-0)" font-size="13px"><text x="1045.5" y="194.5">- alerts: provider.Alerts</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1044-207-472-26-0)" font-size="13px"><text x="1045.5" y="220.5">- stage: notify.Stage</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1044-233-472-26-0)" font-size="13px"><text x="1045.5" y="246.5">- marker: types.Marker</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1044-259-472-26-0)" font-size="13px"><text x="1045.5" y="272.5">- aggrGroups: map[*Route]map[model.Fingerprint]*aggrGroup</text></g><path d="M 1560 149 L 1560 123 L 1780 123 L 1780 149" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1560 149 L 1560 279 L 1780 279 L 1780 149" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1560 149 L 1780 149" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1566.5" y="141">aggrGroup</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1564-154-212-26-0)" font-size="13px"><text x="1565.5" y="167.5">- labels: model.LabelSet</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1564-180-212-26-0)" font-size="13px"><text x="1565.5" y="193.5">- opts: *RouteOpts</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1564-206-212-26-0)" font-size="13px"><text x="1565.5" y="219.5">- logger: log.Logger</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1564-232-212-26-0)" font-size="13px"><text x="1565.5" y="245.5">- routeKey: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1564-258-212-26-0)" font-size="13px"><text x="1565.5" y="271.5">- alerts: *store.Alerts</text></g><path d="M 1040 189 L 940 189 Q 930 189 930 179 L 930 164 Q 930 154 920 154 L 826.37 154" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 821.12 154 L 828.12 150.5 L 826.37 154 L 828.12 157.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1560 162 L 1550 162 Q 1540 162 1540 172 L 1540 257 Q 1540 267 1533.18 267 L 1526.37 267" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1521.12 267 L 1528.12 263.5 L 1526.37 267 L 1528.12 270.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1780 162 L 1790 162 Q 1800 162 1800 172 L 1800 449 Q 1800 459 1790 459 L 1736.37 459" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1731.12 459 L 1738.12 455.5 L 1736.37 459 L 1738.12 462.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 102px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 创建告警分发器</div></div></div></foreignObject><text x="29" y="106" fill="#000000" font-family="source code pro" font-size="13px">1. 创建告警分发器</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 264px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 运行分发器</div></div></div></foreignObject><text x="29" y="268" fill="#000000" font-family="source code pro" font-size="13px">2. 运行分发器</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 431px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. 告警分组路由</div></div></div></foreignObject><text x="29" y="435" fill="#000000" font-family="source code pro" font-size="13px">3. 告警分组路由</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 35px; margin-left: 75px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">分发器实现</div></div></div></foreignObject><text x="75" y="40" fill="#000000" font-family="source code pro" font-size="18px" text-anchor="middle">分发器实现</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 361px; margin-left: 548px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; "><span style="font-size: 13px">查找告警分组，并处理告警</span></div></div></div></foreignObject><text x="548" y="366" fill="#000000" font-family="source code pro" font-size="18px" text-anchor="middle">查找告警分组，并处理告警</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 514px; margin-left: 1090px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; "><font style="font-size: 13px">运行告警分组，执行流式处理</font></div></div></div></foreignObject><text x="1090" y="519" fill="#000000" font-family="source code pro" font-size="18px" text-anchor="middle">运行告警分组，执行流式处理</text></switch></g></g></svg>