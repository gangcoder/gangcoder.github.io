<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2874px" height="1026px" viewBox="-0.5 -0.5 2874 1026" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-10-26T15:07:57.427Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;quh9RTJkNfkLuYKHJiC_&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;iXGwnZkE1OC5YndRpIWv&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="57" y="170" width="81" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 180px; margin-left: 59px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">1. 查询节点列表</div></div></div></foreignObject><text x="59" y="184" fill="#000000" font-family="source code pro" font-size="13px">1. 查询节点列表</text></switch></g><rect x="57" y="204" width="214" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 207px; height: 1px; padding-top: 234px; margin-left: 64px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">func LookupRoute(...)</div></div></div></foreignObject><text x="64" y="238" fill="#000000" font-family="source code pro" font-size="13px">func LookupRoute(...)</text></switch></g><path d="M 370.01 273.96 L 370.5 276.98 Q 371 280 361 280 L 47 280 Q 37 280 37 290 L 37 676 Q 37 686 47 686 L 120.63 686" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 125.88 686 L 118.88 689.5 L 120.63 686 L 118.88 682.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="all"/><rect x="371" y="180" width="496" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 489px; height: 1px; padding-top: 234px; margin-left: 378px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">routes, err := opts.Router.Lookup(req.Service(), query...)<br />for _, route := range routes {<br />    addrs = append(addrs, route.Address)<br />}<br />return addrs, nil</div></div></div></foreignObject><text x="378" y="238" fill="#000000" font-family="source code pro" font-size="13px">routes, err := opts.Router.Lookup(req.Service(), query...)...</text></switch></g><path d="M 271 234 L 364.63 234" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 369.88 234 L 362.88 237.5 L 364.63 234 L 362.88 230.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="57" y="305" width="81" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 315px; margin-left: 59px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">2. 节点路由实现</div></div></div></foreignObject><text x="59" y="319" fill="#000000" font-family="source code pro" font-size="13px">2. 节点路由实现</text></switch></g><rect x="57" y="335" width="358" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 365px; margin-left: 64px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">func NewRouter(opts ...router.Option)</div></div></div></foreignObject><text x="64" y="369" fill="#000000" font-family="source code pro" font-size="13px">func NewRouter(opts ...router.Option)</text></switch></g><rect x="515" y="335" width="292" height="144" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 285px; height: 1px; padding-top: 407px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">regRouter.NewRouter()<br />r := &amp;rtr{<br />    options:  options,<br />    initChan: make(chan bool),<br />}<br />r.table = newTable()<br />r.start()<br />return r</div></div></div></foreignObject><text x="522" y="411" fill="#000000" font-family="source code pro" font-size="13px">regRouter.NewRouter()...</text></switch></g><rect x="907" y="377" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 407px; margin-left: 914px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">func newTable()</div></div></div></foreignObject><text x="914" y="411" fill="#000000" font-family="source code pro" font-size="13px">func newTable()</text></switch></g><rect x="1154" y="359" width="430" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 423px; height: 1px; padding-top: 407px; margin-left: 1161px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return &amp;table{<br />    routes:   make(map[string]map[uint64]*route),<br />    watchers: make(map[string]*tableWatcher),<br />}</div></div></div></foreignObject><text x="1161" y="411" fill="#000000" font-family="source code pro" font-size="13px">return &amp;table{...</text></switch></g><rect x="907" y="515" width="88" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 81px; height: 1px; padding-top: 545px; margin-left: 914px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start()</div></div></div></foreignObject><text x="914" y="549" fill="#000000" font-family="source code pro" font-size="13px">start()</text></switch></g><rect x="1093" y="467" width="394" height="156" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 387px; height: 1px; padding-top: 545px; margin-left: 1100px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">go func() {<br />    for {<br />        select {<br />        case &lt;-refresh:<br />            r.loadRoutes(r.options.Registry)<br />        }<br />    }<br />}()<br />return nil</div></div></div></foreignObject><text x="1100" y="549" fill="#000000" font-family="source code pro" font-size="13px">go func() {...</text></switch></g><rect x="1567" y="515" width="322" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 315px; height: 1px; padding-top: 545px; margin-left: 1574px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">loadRoutes(reg registry.Registry)</div></div></div></foreignObject><text x="1574" y="549" fill="#000000" font-family="source code pro" font-size="13px">loadRoutes(reg registry.Registry)</text></switch></g><rect x="1977" y="461" width="390" height="168" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 383px; height: 1px; padding-top: 545px; margin-left: 1984px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">services, err := reg.ListServices(...)<br />for _, service := range services {<br />    routes := r.createRoutes(service, domain)<br />    if len(routes) &gt; 0 {<br />        for _, rt := range routes {<br />            err := r.table.Create(rt)<br />        }<br />    }<br />}<br />return nil</div></div></div></foreignObject><text x="1984" y="549" fill="#000000" font-family="source code pro" font-size="13px">services, err := reg.ListServices(...)...</text></switch></g><rect x="2087" y="644" width="223" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 216px; height: 1px; padding-top: 674px; margin-left: 2094px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Create(r router.Route)</div></div></div></foreignObject><text x="2094" y="678" fill="#000000" font-family="source code pro" font-size="13px">Create(r router.Route)</text></switch></g><rect x="2407" y="608" width="436" height="132" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 429px; height: 1px; padding-top: 674px; margin-left: 2414px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">service := r.Service<br />sum := r.Hash()<br />if _, ok := t.routes[service]; !ok {<br />    t.routes[service] = make(map[uint64]*route)<br />}<br />t.routes[service][sum] = &amp;route{r, time.Now()}<br />return nil</div></div></div></foreignObject><text x="2414" y="678" fill="#000000" font-family="source code pro" font-size="13px">service := r.Service...</text></switch></g><rect x="127" y="656" width="124" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 686px; margin-left: 134px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Lookup(...)</div></div></div></foreignObject><text x="134" y="690" fill="#000000" font-family="source code pro" font-size="13px">Lookup(...)</text></switch></g><rect x="351" y="650" width="358" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 686px; margin-left: 358px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">routes, err := r.table.Query(service)<br />return routes, nil</div></div></div></foreignObject><text x="358" y="690" fill="#000000" font-family="source code pro" font-size="13px">routes, err := r.table.Query(service)...</text></switch></g><rect x="809" y="656" width="214" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 207px; height: 1px; padding-top: 686px; margin-left: 816px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Query(service string)</div></div></div></foreignObject><text x="816" y="690" fill="#000000" font-family="source code pro" font-size="13px">Query(service string)</text></switch></g><rect x="1113" y="632" width="352" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 345px; height: 1px; padding-top: 686px; margin-left: 1120px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">routeMap, ok := t.routes[service]<br />for _, rt := range routeMap {<br />    routes = append(routes, rt.route)<br />}<br />return routes, nil</div></div></div></foreignObject><text x="1120" y="690" fill="#000000" font-family="source code pro" font-size="13px">routeMap, ok := t.routes[service]...</text></switch></g><path d="M 415 365 L 455 365 Q 465 365 465 375 L 465 397 Q 465 407 475 407 L 508.63 407" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 513.88 407 L 506.88 410.5 L 508.63 407 L 506.88 403.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 807 407 L 900.63 407" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 905.88 407 L 898.88 410.5 L 900.63 407 L 898.88 403.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1067 407 L 1147.63 407" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1152.88 407 L 1145.88 410.5 L 1147.63 407 L 1145.88 403.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 807 407 L 857 407 Q 867 407 867 417 L 867 535 Q 867 545 877 545 L 900.63 545" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 905.88 545 L 898.88 548.5 L 900.63 545 L 898.88 541.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 995 545 L 1086.63 545" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1091.88 545 L 1084.88 548.5 L 1086.63 545 L 1084.88 541.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1487 545 L 1560.63 545" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1565.88 545 L 1558.88 548.5 L 1560.63 545 L 1558.88 541.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1889 545 L 1970.63 545" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1975.88 545 L 1968.88 548.5 L 1970.63 545 L 1968.88 541.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 2010.15 631.02 L 2010.19 664 Q 2010.2 674 2020.2 674 L 2080.63 674" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2085.88 674 L 2078.88 677.5 L 2080.63 674 L 2078.88 670.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 2310 674 L 2400.63 674" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2405.88 674 L 2398.88 677.5 L 2400.63 674 L 2398.88 670.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 251 686 L 344.63 686" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 349.88 686 L 342.88 689.5 L 344.63 686 L 342.88 682.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 709 686 L 802.63 686" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 807.88 686 L 800.88 689.5 L 802.63 686 L 800.88 682.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1023 686 L 1106.63 686" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1111.88 686 L 1104.88 689.5 L 1106.63 686 L 1104.88 682.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="57" y="770" width="99" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 780px; margin-left: 59px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">3. 负载均衡选择节点</div></div></div></foreignObject><text x="59" y="784" fill="#000000" font-family="source code pro" font-size="13px">3. 负载均衡选择节点</text></switch></g><rect x="57" y="800" width="214" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 207px; height: 1px; padding-top: 830px; margin-left: 64px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">func NewSelector(...)</div></div></div></foreignObject><text x="64" y="834" fill="#000000" font-family="source code pro" font-size="13px">func NewSelector(...)</text></switch></g><rect x="371" y="800" width="223" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 216px; height: 1px; padding-top: 830px; margin-left: 378px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return new(roundrobin)</div></div></div></foreignObject><text x="378" y="834" fill="#000000" font-family="source code pro" font-size="13px">return new(roundrobin)</text></switch></g><rect x="127" y="875" width="124" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 905px; margin-left: 134px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Select(...)</div></div></div></foreignObject><text x="134" y="909" fill="#000000" font-family="source code pro" font-size="13px">Select(...)</text></switch></g><rect x="351" y="875" width="319" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 312px; height: 1px; padding-top: 935px; margin-left: 358px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">var i int<br />return func() string {<br />    route := routes[i%len(routes)]<br />    i++<br />    return route<br />}, nil</div></div></div></foreignObject><text x="358" y="939" fill="#000000" font-family="source code pro" font-size="13px">var i int...</text></switch></g><path d="M 271 830 L 364.63 830" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 369.88 830 L 362.88 833.5 L 364.63 830 L 362.88 826.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 251 905 L 291 905 Q 301 905 301 915 L 301 925 Q 301 935 311 935 L 344.63 935" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 349.88 935 L 342.88 938.5 L 344.63 935 L 342.88 931.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="57" y="30" width="360" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 59px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap; ">Go-Micro 客户端服务发现与节点选择实现</div></div></div></foreignObject><text x="59" y="50" fill="#000000" font-family="source code pro" font-size="18px" font-weight="bold">Go-Micro 客户端服务发现与节点选择实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>