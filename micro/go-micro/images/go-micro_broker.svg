<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2948px" height="1404px" viewBox="-0.5 -0.5 2948 1404" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-10-26T00:53:22.563Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;RHOlzeBvFe_QNWeEwVER&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;SRR7cfADLoO1pqAPkLi7&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-822-989-355-26-0"><rect x="822" y="989" width="355" height="26"/></clipPath><clipPath id="mx-clip-822-1015-355-26-0"><rect x="822" y="1015" width="355" height="26"/></clipPath><clipPath id="mx-clip-822-1041-355-26-0"><rect x="822" y="1041" width="355" height="26"/></clipPath><clipPath id="mx-clip-822-1067-355-26-0"><rect x="822" y="1067" width="355" height="26"/></clipPath></defs><g><path d="M 817 984 L 817 958 L 1177 958 L 1177 984" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 817 984 L 817 1088 L 1177 1088 L 1177 984" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 817 984 L 1177 984" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="823.5" y="976">natsBroker</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-822-989-355-26-0)" font-size="13px"><text x="823.5" y="1002.5">- addrs: []string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-822-1015-355-26-0)" font-size="13px"><text x="823.5" y="1028.5">- conn: *nats.Conn</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-822-1041-355-26-0)" font-size="13px"><text x="823.5" y="1054.5">- opts: broker.Options</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-822-1067-355-26-0)" font-size="13px"><text x="823.5" y="1080.5">- nopts: nats.Options</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 179px; margin-left: 69px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 订阅消息</div></div></div></foreignObject><text x="69" y="183" fill="#000000" font-family="source code pro" font-size="13px">1. 订阅消息</text></switch></g><rect x="67" y="200" width="330" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 323px; height: 1px; padding-top: 230px; margin-left: 74px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Subscribe(topic string, v interface{})</div></div></div></foreignObject><text x="74" y="234" fill="#000000" font-family="source code pro" font-size="13px">Subscribe(topic string, v interface{})</text></switch></g><rect x="487" y="200" width="521" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 514px; height: 1px; padding-top: 230px; margin-left: 494px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return s.Server().Subscribe(s.Server().NewSubscriber(topic, v))</div></div></div></foreignObject><text x="494" y="234" fill="#000000" font-family="source code pro" font-size="13px">return s.Server().Subscribe(s.Server().NewSubscriber(topic, v))</text></switch></g><rect x="1117" y="200" width="331" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 324px; height: 1px; padding-top: 230px; margin-left: 1124px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">s.Server().NewSubscriber(topic, v)</div></div></div></foreignObject><text x="1124" y="234" fill="#000000" font-family="source code pro" font-size="13px">s.Server().NewSubscriber(topic, v)</text></switch></g><rect x="1548" y="200" width="385" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 378px; height: 1px; padding-top: 230px; margin-left: 1555px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return newSubscriber(topic, sb, opts...)</div></div></div></foreignObject><text x="1555" y="234" fill="#000000" font-family="source code pro" font-size="13px">return newSubscriber(topic, sb, opts...)</text></switch></g><rect x="2033" y="200" width="232" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 225px; height: 1px; padding-top: 230px; margin-left: 2040px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func newSubscriber(...)</div></div></div></foreignObject><text x="2040" y="234" fill="#000000" font-family="source code pro" font-size="13px">func newSubscriber(...)</text></switch></g><rect x="2407" y="164" width="510" height="132" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 503px; height: 1px; padding-top: 230px; margin-left: 2414px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">var handlers []*handler<br />if typ := reflect.TypeOf(sub); typ.Kind() == reflect.Func {<br />    h := &amp;handler{<br />        method: reflect.ValueOf(sub),<br />    }<br />    handlers = append(handlers, h)<br />}</div></div></div></foreignObject><text x="2414" y="234" fill="#000000" font-family="source code pro" font-size="13px">var handlers []*handler...</text></switch></g><rect x="2407" y="310" width="260" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 253px; height: 1px; padding-top: 370px; margin-left: 2414px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return &amp;subscriber{<br />    topic:      topic,<br />    subscriber: sub,<br />    handlers:   handlers,<br />    endpoints:  endpoints,<br />}</div></div></div></foreignObject><text x="2414" y="374" fill="#000000" font-family="source code pro" font-size="13px">return &amp;subscriber{...</text></switch></g><rect x="1117" y="276" width="250" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 243px; height: 1px; padding-top: 306px; margin-left: 1124px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">s.Server().Subscribe(...)</div></div></div></foreignObject><text x="1124" y="310" fill="#000000" font-family="source code pro" font-size="13px">s.Server().Subscribe(...)</text></switch></g><rect x="1446" y="270" width="241" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 234px; height: 1px; padding-top: 306px; margin-left: 1453px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">g.subscribers[sub] = nil<br />return nil</div></div></div></foreignObject><text x="1453" y="310" fill="#000000" font-family="source code pro" font-size="13px">g.subscribers[sub] = nil...</text></switch></g><path d="M 397 230 L 480.63 230" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 485.88 230 L 478.88 233.5 L 480.63 230 L 478.88 226.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008 230 L 1110.63 230" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1115.88 230 L 1108.88 233.5 L 1110.63 230 L 1108.88 226.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1448 230 L 1541.63 230" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1546.88 230 L 1539.88 233.5 L 1541.63 230 L 1539.88 226.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1933 230 L 2026.63 230" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2031.88 230 L 2024.88 233.5 L 2026.63 230 L 2024.88 226.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2265 230 L 2400.63 230" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2405.88 230 L 2398.88 233.5 L 2400.63 230 L 2398.88 226.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2265 230 L 2327 230 Q 2337 230 2337 240 L 2337 360 Q 2337 370 2347 370 L 2400.63 370" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2405.88 370 L 2398.88 373.5 L 2400.63 370 L 2398.88 366.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008 230 L 1057 230 Q 1067 230 1067 240 L 1067 296 Q 1067 306 1077 306 L 1110.63 306" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1115.88 306 L 1108.88 309.5 L 1110.63 306 L 1108.88 302.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1367 306 L 1439.63 306" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1444.88 306 L 1437.88 309.5 L 1439.63 306 L 1437.88 302.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 332px; margin-left: 69px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 连接Broker</div></div></div></foreignObject><text x="69" y="336" fill="#000000" font-family="source code pro" font-size="13px">2. 连接Broker</text></switch></g><rect x="67" y="358" width="88" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 81px; height: 1px; padding-top: 388px; margin-left: 74px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Start()</div></div></div></foreignObject><text x="74" y="392" fill="#000000" font-family="source code pro" font-size="13px">Start()</text></switch></g><path d="M 255 412 L 67 412 Q 57 412 57 422 L 57 1091 Q 57 1101 67 1101 L 91.63 1101" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 96.88 1101 L 89.88 1104.5 L 91.63 1101 L 89.88 1097.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="255" y="340" width="282" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 275px; height: 1px; padding-top: 388px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">if len(g.subscribers) &gt; 0 {<br />    config.Broker.Connect()<br />}<br />return nil</div></div></div></foreignObject><text x="262" y="392" fill="#000000" font-family="source code pro" font-size="13px">if len(g.subscribers) &gt; 0 {...</text></switch></g><rect x="197" y="480" width="115" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 510px; margin-left: 204px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Register()</div></div></div></foreignObject><text x="204" y="514" fill="#000000" font-family="source code pro" font-size="13px">Register()</text></switch></g><path d="M 412 540 L 57 540 Q 47 540 47 550 L 47 1221 Q 47 1231 57 1231 L 90.63 1231" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 95.88 1231 L 88.88 1234.5 L 90.63 1231 L 88.88 1227.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="412" y="450" width="609" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 602px; height: 1px; padding-top: 510px; margin-left: 419px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for sb := range g.subscribers {<br />    handler := g.createSubHandler(sb, g.opts)<br />    sub, err := config.Broker.Subscribe(sb.Topic(), handler, opts...)<br />    g.subscribers[sb] = []broker.Subscriber{sub}<br />}<br />return nil</div></div></div></foreignObject><text x="419" y="514" fill="#000000" font-family="source code pro" font-size="13px">for sb := range g.subscribers {...</text></switch></g><rect x="1111" y="480" width="214" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 207px; height: 1px; padding-top: 510px; margin-left: 1118px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">createSubHandler(...)</div></div></div></foreignObject><text x="1118" y="514" fill="#000000" font-family="source code pro" font-size="13px">createSubHandler(...)</text></switch></g><rect x="1457" y="410" width="570" height="280" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 563px; height: 1px; padding-top: 550px; margin-left: 1464px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return func(msg *broker.Message) (err error) {<br />    for i := 0; i &lt; len(sb.handlers); i++ {<br />        handler := sb.handlers[i]<br />        fn := func(ctx context.Context, msg server.Message) error {<br />            returnValues := handler.method.Call(vals)<br />        }<br />        go func() {<br />            err := fn(ctx, &amp;rpcMessage{<br />                topic:       sb.topic,<br />                contentType: ct,<br />                payload:     req.Interface(),<br />                header:      msg.Header,<br />                body:        msg.Body,<br />            })<br />        }()<br />    }<br />    return err<br />}</div></div></div></foreignObject><text x="1464" y="554" fill="#000000" font-family="source code pro" font-size="13px">return func(msg *broker.Message) (err error) {...</text></switch></g><path d="M 155 388 L 248.63 388" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 253.88 388 L 246.88 391.5 L 248.63 388 L 246.88 384.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 312 510 L 405.63 510" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 410.88 510 L 403.88 513.5 L 405.63 510 L 403.88 506.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1021 510 L 1104.63 510" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1109.88 510 L 1102.88 513.5 L 1104.63 510 L 1102.88 506.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1325 510 L 1381 510 Q 1391 510 1391 520 L 1391 540 Q 1391 550 1401 550 L 1450.63 550" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1455.88 550 L 1448.88 553.5 L 1450.63 550 L 1448.88 546.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 720px; margin-left: 69px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. 消息发布</div></div></div></foreignObject><text x="69" y="724" fill="#000000" font-family="source code pro" font-size="13px">3. 消息发布</text></switch></g><rect x="67" y="744" width="610" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 603px; height: 1px; padding-top: 774px; margin-left: 74px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">muclient.Publish(ctx, muclient.NewMessage(e.topic, msg), opts...)</div></div></div></foreignObject><text x="74" y="778" fill="#000000" font-family="source code pro" font-size="13px">muclient.Publish(ctx, muclient.NewMessage(e.topic, msg), opts...)</text></switch></g><rect x="777" y="744" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 774px; margin-left: 784px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">NewMessage(...)</div></div></div></foreignObject><text x="784" y="778" fill="#000000" font-family="source code pro" font-size="13px">NewMessage(...)</text></switch></g><rect x="1035" y="744" width="512" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 505px; height: 1px; padding-top: 774px; margin-left: 1042px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return newGRPCEvent(topic, msg, g.opts.ContentType, opts...)</div></div></div></foreignObject><text x="1042" y="778" fill="#000000" font-family="source code pro" font-size="13px">return newGRPCEvent(topic, msg, g.opts.ContentType, opts...)</text></switch></g><rect x="1657" y="720" width="285" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 278px; height: 1px; padding-top: 774px; margin-left: 1664px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return &amp;grpcEvent{<br />    payload:     payload,<br />    topic:       topic,<br />    contentType: contentType,<br />}</div></div></div></foreignObject><text x="1664" y="778" fill="#000000" font-family="source code pro" font-size="13px">return &amp;grpcEvent{...</text></switch></g><rect x="777" y="845" width="133" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 126px; height: 1px; padding-top: 875px; margin-left: 784px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Publish(...)</div></div></div></foreignObject><text x="784" y="879" fill="#000000" font-family="source code pro" font-size="13px">Publish(...)</text></switch></g><path d="M 995 905 L 47 905 Q 37 905 37 915 L 37 1327 Q 37 1337 47 1337 L 91.63 1337" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 96.88 1337 L 89.88 1340.5 L 91.63 1337 L 89.88 1333.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="995" y="815" width="450" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 443px; height: 1px; padding-top: 875px; margin-left: 1002px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">g.opts.Broker.Connect()<br />topic := p.Topic()<br />return g.opts.Broker.Publish(topic, &amp;broker.Message{<br />    Header: md,<br />    Body:   body,<br />}, broker.PublishContext(options.Context))</div></div></div></foreignObject><text x="1002" y="879" fill="#000000" font-family="source code pro" font-size="13px">g.opts.Broker.Connect()...</text></switch></g><path d="M 677 774 L 770.63 774" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 775.88 774 L 768.88 777.5 L 770.63 774 L 768.88 770.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 937 774 L 1028.63 774" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1033.88 774 L 1026.88 777.5 L 1028.63 774 L 1026.88 770.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1547 774 L 1650.63 774" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1655.88 774 L 1648.88 777.5 L 1650.63 774 L 1648.88 770.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 677 774 L 717 774 Q 727 774 727 784 L 727 865 Q 727 875 737 875 L 770.63 875" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 775.88 875 L 768.88 878.5 L 770.63 875 L 768.88 871.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 910 875 L 988.63 875" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 993.88 875 L 986.88 878.5 L 988.63 875 L 986.88 871.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 940px; margin-left: 69px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">4. Broker 实现</div></div></div></foreignObject><text x="69" y="944" fill="#000000" font-family="source code pro" font-size="13px">4. Broker 实现</text></switch></g><rect x="67" y="958" width="358" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 988px; margin-left: 74px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewBroker(opts ...broker.Option)</div></div></div></foreignObject><text x="74" y="992" fill="#000000" font-family="source code pro" font-size="13px">func NewBroker(opts ...broker.Option)</text></switch></g><path d="M 817 972.95 L 782 972.99 Q 772 973 772 980.5 L 772 984.25 Q 772 988 762 988 L 733.37 988" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 728.12 988 L 735.12 984.5 L 733.37 988 L 735.12 991.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><rect x="525" y="940" width="202" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 195px; height: 1px; padding-top: 988px; margin-left: 532px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n := &amp;natsBroker{<br />    opts: options,<br />}<br />return n</div></div></div></foreignObject><text x="532" y="992" fill="#000000" font-family="source code pro" font-size="13px">n := &amp;natsBroker{...</text></switch></g><rect x="98" y="1071" width="106" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 99px; height: 1px; padding-top: 1101px; margin-left: 105px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Connect()</div></div></div></foreignObject><text x="105" y="1105" fill="#000000" font-family="source code pro" font-size="13px">Connect()</text></switch></g><rect x="304" y="1041" width="241" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 234px; height: 1px; padding-top: 1101px; margin-left: 311px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">opts := n.nopts<br />opts.Servers = n.addrs<br />c, err := opts.Connect()<br />n.conn = c<br />n.connected = true<br />return nil</div></div></div></foreignObject><text x="311" y="1105" fill="#000000" font-family="source code pro" font-size="13px">opts := n.nopts...</text></switch></g><rect x="97" y="1201" width="151" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 144px; height: 1px; padding-top: 1231px; margin-left: 104px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Subscribe(...)</div></div></div></foreignObject><text x="104" y="1235" fill="#000000" font-family="source code pro" font-size="13px">Subscribe(...)</text></switch></g><rect x="335" y="1171" width="422" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 415px; height: 1px; padding-top: 1231px; margin-left: 342px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">fn := func(msg *nats.Msg) {<br />    err := n.opts.Codec.Unmarshal(msg.Data, &amp;m)<br />    handler(m)<br />}<br />sub, err = n.conn.Subscribe(topic, fn)<br />return &amp;subscriber{s: sub, opts: opt}, nil</div></div></div></foreignObject><text x="342" y="1235" fill="#000000" font-family="source code pro" font-size="13px">fn := func(msg *nats.Msg) {...</text></switch></g><rect x="98" y="1307" width="133" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 126px; height: 1px; padding-top: 1337px; margin-left: 105px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Publish(...)</div></div></div></foreignObject><text x="105" y="1341" fill="#000000" font-family="source code pro" font-size="13px">Publish(...)</text></switch></g><rect x="311" y="1301" width="340" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 333px; height: 1px; padding-top: 1337px; margin-left: 318px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">b, err := n.opts.Codec.Marshal(msg)<br />return n.conn.Publish(topic, b)</div></div></div></foreignObject><text x="318" y="1341" fill="#000000" font-family="source code pro" font-size="13px">b, err := n.opts.Codec.Marshal(msg)...</text></switch></g><path d="M 425 988 L 518.63 988" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 523.88 988 L 516.88 991.5 L 518.63 988 L 516.88 984.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 204 1101 L 297.63 1101" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 302.88 1101 L 295.88 1104.5 L 297.63 1101 L 295.88 1097.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 248 1231 L 328.63 1231" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 333.88 1231 L 326.88 1234.5 L 328.63 1231 L 326.88 1227.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 231 1337 L 304.63 1337" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 309.88 1337 L 302.88 1340.5 L 304.63 1337 L 302.88 1333.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 69px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap; ">Go-Micro 事件订阅与消费实现</div></div></div></foreignObject><text x="69" y="50" fill="#000000" font-family="source code pro" font-size="18px" font-weight="bold">Go-Micro 事件订阅与消费实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>