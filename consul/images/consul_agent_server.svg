<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2631px" height="633px" viewBox="-0.5 -0.5 2631 633" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-17T01:04:03.362Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;y-8kAFTEvc4Pux-EYO7g&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;B3BiVi6-toGS4SPo7uro&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-876-140-285-26-0"><rect x="876" y="140" width="285" height="26"/></clipPath><clipPath id="mx-clip-876-166-285-26-0"><rect x="876" y="166" width="285" height="26"/></clipPath><clipPath id="mx-clip-876-192-285-26-0"><rect x="876" y="192" width="285" height="26"/></clipPath><clipPath id="mx-clip-876-218-285-26-0"><rect x="876" y="218" width="285" height="26"/></clipPath></defs><g><path d="M 871 135 L 871 109 L 1161 109 L 1161 135" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 871 135 L 871 239 L 1161 239 L 1161 135" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 135 L 1161 135" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="877.5" y="127">Server</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-876-140-285-26-0)" font-size="13px"><text x="877.5" y="153.5">- config: *Config</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-876-166-285-26-0)" font-size="13px"><text x="877.5" y="179.5">- fsm: *fsm.FSM</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-876-192-285-26-0)" font-size="13px"><text x="877.5" y="205.5">- Listener: net.Listener</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-876-218-285-26-0)" font-size="13px"><text x="877.5" y="231.5">- rpcServer: *rpc.Server</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 161px; margin-left: 33px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 启动server 服务</div></div></div></foreignObject><text x="33" y="165" fill="#000000" font-family="source code pro" font-size="13px">1. 启动server 服务</text></switch></g><rect x="31" y="179" width="270" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 263px; height: 1px; padding-top: 209px; margin-left: 38px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewServerWithOptions(...)</div></div></div></foreignObject><text x="38" y="213" fill="#000000" font-family="source code pro" font-size="13px">func NewServerWithOptions(...)</text></switch></g><rect x="426" y="174" width="335" height="70" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 328px; height: 1px; padding-top: 209px; margin-left: 433px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">s := &amp;Server{<br />    config:            config,<br />    rpcServer:         rpc.NewServer(),<br />}</div></div></div></foreignObject><text x="433" y="213" fill="#000000" font-family="source code pro" font-size="13px">s := &amp;Server{...</text></switch></g><rect x="426" y="256" width="215" height="70" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 208px; height: 1px; padding-top: 291px; margin-left: 433px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">s.setupRPC()<br />go s.listen(s.Listener)<br />return s, nil</div></div></div></foreignObject><text x="433" y="295" fill="#000000" font-family="source code pro" font-size="13px">s.setupRPC()...</text></switch></g><path d="M 301 209 L 419.63 209" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 424.88 209 L 417.88 212.5 L 419.63 209 L 417.88 205.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 301 209 L 351 209 Q 361 209 361 219 L 361 281 Q 361 291 371 291 L 419.63 291" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 424.88 291 L 417.88 294.5 L 419.63 291 L 417.88 287.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 350px; margin-left: 33px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 初始化RPC 监听</div></div></div></foreignObject><text x="33" y="354" fill="#000000" font-family="source code pro" font-size="13px">2. 初始化RPC 监听</text></switch></g><rect x="31" y="372" width="124" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 402px; margin-left: 38px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func init()</div></div></div></foreignObject><text x="38" y="406" fill="#000000" font-family="source code pro" font-size="13px">func init()</text></switch></g><rect x="255" y="360" width="826" height="84" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 819px; height: 1px; padding-top: 402px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">registerEndpoint(func(s *Server) interface{} { return &amp;Catalog{s, s.loggers.Named(logging.Catalog)} })<br />registerEndpoint(func(s *Server) interface{} { return &amp;Health{s} })<br />registerEndpoint(func(s *Server) interface{} { return &amp;KVS{s, s.loggers.Named(logging.KV)} })</div></div></div></foreignObject><text x="262" y="406" fill="#000000" font-family="source code pro" font-size="13px">registerEndpoint(func(s *Server) interface{} { return &amp;Catalog{s, s.loggers.Named(logging.Catalog)} })...</text></switch></g><rect x="1170" y="372" width="291" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 284px; height: 1px; padding-top: 402px; margin-left: 1177px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func registerEndpoint(fn factory)</div></div></div></foreignObject><text x="1177" y="406" fill="#000000" font-family="source code pro" font-size="13px">func registerEndpoint(fn factory)</text></switch></g><rect x="1551" y="372" width="322" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 315px; height: 1px; padding-top: 402px; margin-left: 1558px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">endpoints = append(endpoints, fn)</div></div></div></foreignObject><text x="1558" y="406" fill="#000000" font-family="source code pro" font-size="13px">endpoints = append(endpoints, fn)</text></switch></g><rect x="731" y="261" width="115" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 291px; margin-left: 738px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">setupRPC()</div></div></div></foreignObject><text x="738" y="295" fill="#000000" font-family="source code pro" font-size="13px">setupRPC()</text></switch></g><rect x="941" y="245" width="418" height="92" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 411px; height: 1px; padding-top: 291px; margin-left: 948px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for _, fn := range endpoints {<br />    s.rpcServer.Register(fn(s))<br />}<br />ln, err := net.ListenTCP("tcp", s.config.RPCAddr)<br />return nil</div></div></div></foreignObject><text x="948" y="295" fill="#000000" font-family="source code pro" font-size="13px">for _, fn := range endpoints {...</text></switch></g><path d="M 155 402 L 248.63 402" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 253.88 402 L 246.88 405.5 L 248.63 402 L 246.88 398.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1081 402 L 1163.63 402" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1168.88 402 L 1161.88 405.5 L 1163.63 402 L 1161.88 398.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1461 402 L 1544.63 402" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1549.88 402 L 1542.88 405.5 L 1544.63 402 L 1542.88 398.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 641 291 L 724.63 291" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 729.88 291 L 722.88 294.5 L 724.63 291 L 722.88 287.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 846 291 L 934.63 291" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 939.88 291 L 932.88 294.5 L 934.63 291 L 932.88 287.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 496px; margin-left: 33px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. RPC 监听与处理</div></div></div></foreignObject><text x="33" y="500" fill="#000000" font-family="source code pro" font-size="13px">3. RPC 监听与处理</text></switch></g><rect x="30.5" y="506" width="210" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 203px; height: 1px; padding-top: 536px; margin-left: 38px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">go s.listen(s.Listener)</div></div></div></foreignObject><text x="38" y="540" fill="#000000" font-family="source code pro" font-size="13px">go s.listen(s.Listener)</text></switch></g><rect x="320.5" y="506" width="260" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 253px; height: 1px; padding-top: 536px; margin-left: 328px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">listen(listener net.Listener)</div></div></div></foreignObject><text x="328" y="540" fill="#000000" font-family="source code pro" font-size="13px">listen(listener net.Listener)</text></switch></g><rect x="680.5" y="488" width="310" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 303px; height: 1px; padding-top: 536px; margin-left: 688px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    conn, err := listener.Accept()<br />    go s.handleConn(conn, false)<br />}</div></div></div></foreignObject><text x="688" y="540" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><rect x="1080.5" y="506" width="321" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 314px; height: 1px; padding-top: 536px; margin-left: 1088px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">handleConn(conn net.Conn, isTLS bool)</div></div></div></foreignObject><text x="1088" y="540" fill="#000000" font-family="source code pro" font-size="13px">handleConn(conn net.Conn, isTLS bool)</text></switch></g><rect x="1490.5" y="470" width="300" height="132" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 293px; height: 1px; padding-top: 536px; margin-left: 1498px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">typ := pool.RPCType(buf[0])<br />switch typ {<br />case pool.RPCConsul:<br />    s.handleConsulConn(conn)<br />case pool.RPCSnapshot:<br />    s.handleSnapshotConn(conn)<br />}</div></div></div></foreignObject><text x="1498" y="540" fill="#000000" font-family="source code pro" font-size="13px">typ := pool.RPCType(buf[0])...</text></switch></g><rect x="1865.5" y="506" width="275" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 268px; height: 1px; padding-top: 536px; margin-left: 1873px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">handleConsulConn(conn net.Conn)</div></div></div></foreignObject><text x="1873" y="540" fill="#000000" font-family="source code pro" font-size="13px">handleConsulConn(conn net.Conn)</text></switch></g><rect x="2210.5" y="488" width="390" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 383px; height: 1px; padding-top: 536px; margin-left: 2218px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">rpcCodec := msgpackrpc.NewServerCodec(conn)<br />for {<br />    err := s.rpcServer.ServeRequest(rpcCodec)<br />}</div></div></div></foreignObject><text x="2218" y="540" fill="#000000" font-family="source code pro" font-size="13px">rpcCodec := msgpackrpc.NewServerCodec(conn)...</text></switch></g><path d="M 240.5 536 L 314.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 319.38 536 L 312.38 539.5 L 314.13 536 L 312.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 580.5 536 L 674.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 679.38 536 L 672.38 539.5 L 674.13 536 L 672.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 990.5 536 L 1074.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1079.38 536 L 1072.38 539.5 L 1074.13 536 L 1072.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1401.5 536 L 1484.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1489.38 536 L 1482.38 539.5 L 1484.13 536 L 1482.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1790.5 536 L 1859.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1864.38 536 L 1857.38 539.5 L 1859.13 536 L 1857.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2140.5 536 L 2204.13 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2209.38 536 L 2202.38 539.5 L 2204.13 536 L 2202.38 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 148 L 826 148 Q 816 148 816 158 L 816 199 Q 816 209 806 209 L 767.37 209" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 762.12 209 L 769.12 205.5 L 767.37 209 L 769.12 212.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 33px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">Consul agent server 模式</div></div></div></foreignObject><text x="33" y="50" fill="#000000" font-family="source code pro" font-size="18px">Consul agent server 模式</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>