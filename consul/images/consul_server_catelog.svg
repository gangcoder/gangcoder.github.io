<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2597px" height="699px" viewBox="-0.5 -0.5 2597 699" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-18T01:11:02.637Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;mAL0SpEq12i0Pb-PmA4x&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;726cXF2upt9g-_W9DEvg&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="30" y="150" width="63" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 160px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">1. 服务注册</div></div></div></foreignObject><text x="32" y="164" fill="#000000" font-family="source code pro" font-size="13px">1. 服务注册</text></switch></g><rect x="30" y="180" width="142" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 135px; height: 1px; padding-top: 210px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Register(...)</div></div></div></foreignObject><text x="37" y="214" fill="#000000" font-family="source code pro" font-size="13px">Register(...)</text></switch></g><rect x="308" y="180" width="438" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 431px; height: 1px; padding-top: 210px; margin-left: 315px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">c.srv.forward("Catalog.Register", args, args, reply)</div></div></div></foreignObject><text x="315" y="214" fill="#000000" font-family="source code pro" font-size="13px">c.srv.forward("Catalog.Register", args, args, reply)</text></switch></g><rect x="308" y="250" width="533" height="84" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 526px; height: 1px; padding-top: 292px; margin-left: 315px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">state := c.srv.fsm.State()<br />resp, err := c.srv.raftApply(structs.RegisterRequestType, args)<br />return nil</div></div></div></foreignObject><text x="315" y="296" fill="#000000" font-family="source code pro" font-size="13px">state := c.srv.fsm.State()...</text></switch></g><path d="M 172 210 L 301.63 210" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 306.88 210 L 299.88 213.5 L 301.63 210 L 299.88 206.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 172 210 L 210 210 Q 220 210 220 220 L 220 282 Q 220 292 230 292 L 301.63 292" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 306.88 292 L 299.88 295.5 L 301.63 292 L 299.88 288.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="370" width="63" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 380px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">2. 服务发现</div></div></div></foreignObject><text x="32" y="384" fill="#000000" font-family="source code pro" font-size="13px">2. 服务发现</text></switch></g><rect x="30" y="410" width="178" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 171px; height: 1px; padding-top: 440px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ServiceNodes(...)</div></div></div></foreignObject><text x="37" y="444" fill="#000000" font-family="source code pro" font-size="13px">ServiceNodes(...)</text></switch></g><rect x="308" y="380" width="722" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 715px; height: 1px; padding-top: 440px; margin-left: 315px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">switch {<br />default:<br />    f = func(ws memdb.WatchSet, s *state.Store) (uint64, structs.ServiceNodes, error) {<br />        return s.ServiceNodes(ws, args.ServiceName, &amp;args.EnterpriseMeta)<br />    }<br />}</div></div></div></foreignObject><text x="315" y="444" fill="#000000" font-family="source code pro" font-size="13px">switch {...</text></switch></g><rect x="308" y="512" width="642" height="156" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 635px; height: 1px; padding-top: 590px; margin-left: 315px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">err = c.srv.blockingQuery(<br />    &amp;args.QueryOptions,<br />    &amp;reply.QueryMeta,<br />    func(ws memdb.WatchSet, state *state.Store) error {<br />        index, services, err := f(ws, state)<br />        reply.Index, reply.ServiceNodes = index, services<br />        return c.srv.sortNodesByDistanceFrom(args.Source, reply.ServiceNodes)<br />    })<br />return err</div></div></div></foreignObject><text x="315" y="594" fill="#000000" font-family="source code pro" font-size="13px">err = c.srv.blockingQuery(...</text></switch></g><rect x="1120" y="410" width="178" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 171px; height: 1px; padding-top: 440px; margin-left: 1127px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ServiceNodes(...)</div></div></div></foreignObject><text x="1127" y="444" fill="#000000" font-family="source code pro" font-size="13px">ServiceNodes(...)</text></switch></g><rect x="1398" y="410" width="458" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 451px; height: 1px; padding-top: 440px; margin-left: 1405px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return s.serviceNodes(ws, serviceName, false, entMeta)</div></div></div></foreignObject><text x="1405" y="444" fill="#000000" font-family="source code pro" font-size="13px">return s.serviceNodes(ws, serviceName, false, entMeta)</text></switch></g><rect x="1936" y="404" width="610" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 603px; height: 1px; padding-top: 440px; margin-left: 1943px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">tx := s.db.Txn(false)<br />services, err := s.catalogServiceNodeList(tx, serviceName, index, entMeta)</div></div></div></foreignObject><text x="1943" y="444" fill="#000000" font-family="source code pro" font-size="13px">tx := s.db.Txn(false)...</text></switch></g><rect x="1936" y="488" width="630" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 623px; height: 1px; padding-top: 536px; margin-left: 1943px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">for service := services.Next(); service != nil; service = services.Next() {<br />    results = append(results, service.(*structs.ServiceNode))<br />}<br />return idx, results, nil</div></div></div></foreignObject><text x="1943" y="540" fill="#000000" font-family="source code pro" font-size="13px">for service := services.Next(); service != nil; service = services.Next() {...</text></switch></g><path d="M 208 440 L 301.63 440" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 306.88 440 L 299.88 443.5 L 301.63 440 L 299.88 436.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 208 440 L 250 440 Q 260 440 260 450 L 260 580 Q 260 590 270 590 L 301.63 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 306.88 590 L 299.88 593.5 L 301.63 590 L 299.88 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1030 440 L 1113.63 440" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1118.88 440 L 1111.88 443.5 L 1113.63 440 L 1111.88 436.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1298 440 L 1391.63 440" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1396.88 440 L 1389.88 443.5 L 1391.63 440 L 1389.88 436.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1856 440 L 1929.63 440" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1934.88 440 L 1927.88 443.5 L 1929.63 440 L 1927.88 436.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1856 440 L 1876 440 Q 1886 440 1886 450 L 1886 526 Q 1886 536 1896 536 L 1929.63 536" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1934.88 536 L 1927.88 539.5 L 1929.63 536 L 1927.88 532.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="30" width="210" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">Consul Catelog 实现</div></div></div></foreignObject><text x="32" y="50" fill="#000000" font-family="source code pro" font-size="18px">Consul Catelog 实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>