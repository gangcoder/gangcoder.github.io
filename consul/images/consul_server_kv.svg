<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2714px" height="597px" viewBox="-0.5 -0.5 2714 597" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-17T15:07:40.027Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;oqMAPGTm0nKpjhAkZRv-&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;KVZ3EJMbZ-vabfv06CVy&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="30" y="150" width="108" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 160px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">1. KV Get 实现</div></div></div></foreignObject><text x="32" y="164" fill="#000000" font-family="source code pro" font-size="13px">1. KV Get 实现</text></switch></g><rect x="32" y="180" width="97" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 90px; height: 1px; padding-top: 210px; margin-left: 39px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Get(...)</div></div></div></foreignObject><text x="39" y="214" fill="#000000" font-family="source code pro" font-size="13px">Get(...)</text></switch></g><rect x="200" y="180" width="370" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 210px; margin-left: 207px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">k.srv.forward("KVS.Get", args, args, reply)</div></div></div></foreignObject><text x="207" y="214" fill="#000000" font-family="source code pro" font-size="13px">k.srv.forward("KVS.Get", args, args, reply)</text></switch></g><rect x="663" y="84" width="609" height="156" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 602px; height: 1px; padding-top: 162px; margin-left: 670px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return k.srv.blockingQuery(<br />    &amp;args.QueryOptions,<br />    &amp;reply.QueryMeta,<br />    func(ws memdb.WatchSet, state *state.Store) error {<br />        index, ent, err := state.KVSGet(ws, args.Key, &amp;args.EnterpriseMeta)<br />        reply.Index = ent.ModifyIndex<br />        reply.Entries = structs.DirEntries{ent}<br />        return nil<br />    })</div></div></div></foreignObject><text x="670" y="166" fill="#000000" font-family="source code pro" font-size="13px">return k.srv.blockingQuery(...</text></switch></g><rect x="1350" y="132" width="373" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 366px; height: 1px; padding-top: 162px; margin-left: 1357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">k.srv.forward("KVS.Get", args, args, reply)</div></div></div></foreignObject><text x="1357" y="166" fill="#000000" font-family="source code pro" font-size="13px">k.srv.forward("KVS.Get", args, args, reply)</text></switch></g><rect x="1934" y="132" width="133" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 126px; height: 1px; padding-top: 162px; margin-left: 1941px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">forward(...)</div></div></div></foreignObject><text x="1941" y="166" fill="#000000" font-family="source code pro" font-size="13px">forward(...)</text></switch></g><rect x="2133" y="114" width="280" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 273px; height: 1px; padding-top: 162px; margin-left: 2140px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">isLeader, leader := s.getLeader()<br />if isLeader {<br />    return false, nil<br />}</div></div></div></foreignObject><text x="2140" y="166" fill="#000000" font-family="source code pro" font-size="13px">isLeader, leader := s.getLeader()...</text></switch></g><rect x="1350" y="204" width="187" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 180px; height: 1px; padding-top: 234px; margin-left: 1357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">blockingQuery(...)</div></div></div></foreignObject><text x="1357" y="238" fill="#000000" font-family="source code pro" font-size="13px">blockingQuery(...)</text></switch></g><rect x="1624" y="198" width="223" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 216px; height: 1px; padding-top: 234px; margin-left: 1631px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">state := s.fsm.State()<br />err := fn(ws, state)</div></div></div></foreignObject><text x="1631" y="238" fill="#000000" font-family="source code pro" font-size="13px">state := s.fsm.State()...</text></switch></g><rect x="1350" y="298" width="124" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 328px; margin-left: 1357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">KVSGet(...)</div></div></div></foreignObject><text x="1357" y="332" fill="#000000" font-family="source code pro" font-size="13px">KVSGet(...)</text></switch></g><rect x="1544" y="280" width="570" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 563px; height: 1px; padding-top: 328px; margin-left: 1551px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">index, ent, err := state.KVSGet(ws, args.Key, &amp;args.EnterpriseMeta)<br />tx := s.db.Txn(false)<br />defer tx.Abort()<br />return s.kvsGetTxn(tx, ws, key, entMeta)</div></div></div></foreignObject><text x="1551" y="332" fill="#000000" font-family="source code pro" font-size="13px">index, ent, err := state.KVSGet(ws, args.Key, &amp;args.EnterpriseMeta)...</text></switch></g><path d="M 129 210 L 193.63 210" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 198.88 210 L 191.88 213.5 L 193.63 210 L 191.88 206.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 570 210 L 606.5 210 Q 616.5 210 616.5 200 L 616.5 172 Q 616.5 162 626.5 162 L 656.63 162" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 661.88 162 L 654.88 165.5 L 656.63 162 L 654.88 158.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1272 162 L 1343.63 162" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1348.88 162 L 1341.88 165.5 L 1343.63 162 L 1341.88 158.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1723 162 L 1927.63 162" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1932.88 162 L 1925.88 165.5 L 1927.63 162 L 1925.88 158.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 2067 162 L 2126.63 162" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2131.88 162 L 2124.88 165.5 L 2126.63 162 L 2124.88 158.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1272 162 L 1301 162 Q 1311 162 1311 172 L 1311 224 Q 1311 234 1321 234 L 1343.63 234" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1348.88 234 L 1341.88 237.5 L 1343.63 234 L 1341.88 230.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1537 234 L 1617.63 234" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1622.88 234 L 1615.88 237.5 L 1617.63 234 L 1615.88 230.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1272 162 L 1300 162 Q 1310 162 1310 172 L 1310 318 Q 1310 328 1320 328 L 1343.63 328" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1348.88 328 L 1341.88 331.5 L 1343.63 328 L 1341.88 324.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1474 328 L 1537.63 328" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1542.88 328 L 1535.88 331.5 L 1537.63 328 L 1535.88 324.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="390" width="99" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 400px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">2. Apply 实现</div></div></div></foreignObject><text x="32" y="404" fill="#000000" font-family="source code pro" font-size="13px">2. Apply 实现</text></switch></g><rect x="30" y="416" width="115" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 446px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Apply(...)</div></div></div></foreignObject><text x="37" y="450" fill="#000000" font-family="source code pro" font-size="13px">Apply(...)</text></switch></g><rect x="245" y="410" width="495" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 488px; height: 1px; padding-top: 446px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">resp, err := k.srv.raftApply(structs.KVSRequestType, args)<br />return nil</div></div></div></foreignObject><text x="252" y="450" fill="#000000" font-family="source code pro" font-size="13px">resp, err := k.srv.raftApply(structs.KVSRequestType, args)...</text></switch></g><rect x="806" y="416" width="151" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 144px; height: 1px; padding-top: 446px; margin-left: 813px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">raftApply(...)</div></div></div></foreignObject><text x="813" y="450" fill="#000000" font-family="source code pro" font-size="13px">raftApply(...)</text></switch></g><rect x="1057" y="416" width="322" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 315px; height: 1px; padding-top: 446px; margin-left: 1064px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return s.raftApplyMsgpack(t, msg)</div></div></div></foreignObject><text x="1064" y="450" fill="#000000" font-family="source code pro" font-size="13px">return s.raftApplyMsgpack(t, msg)</text></switch></g><rect x="1479" y="416" width="455" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 448px; height: 1px; padding-top: 446px; margin-left: 1486px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">return s.raftApplyWithEncoder(t, msg, structs.Encode)</div></div></div></foreignObject><text x="1486" y="450" fill="#000000" font-family="source code pro" font-size="13px">return s.raftApplyWithEncoder(t, msg, structs.Encode)</text></switch></g><rect x="2010" y="416" width="233" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 226px; height: 1px; padding-top: 446px; margin-left: 2017px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">raftApplyWithEncoder(...)</div></div></div></foreignObject><text x="2017" y="450" fill="#000000" font-family="source code pro" font-size="13px">raftApplyWithEncoder(...)</text></switch></g><rect x="2333" y="410" width="350" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 343px; height: 1px; padding-top: 446px; margin-left: 2340px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">buf, err := encoder(t, msg)<br />future = s.raft.Apply(buf, enqueueLimit)</div></div></div></foreignObject><text x="2340" y="450" fill="#000000" font-family="source code pro" font-size="13px">buf, err := encoder(t, msg)...</text></switch></g><rect x="2333" y="494" width="250" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 243px; height: 1px; padding-top: 530px; margin-left: 2340px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">resp := future.Response()<br />return resp, nil</div></div></div></foreignObject><text x="2340" y="534" fill="#000000" font-family="source code pro" font-size="13px">resp := future.Response()...</text></switch></g><path d="M 145 446 L 238.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 243.88 446 L 236.88 449.5 L 238.63 446 L 236.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 740 446 L 799.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 804.88 446 L 797.88 449.5 L 799.63 446 L 797.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 957 446 L 1050.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1055.88 446 L 1048.88 449.5 L 1050.63 446 L 1048.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1379 446 L 1472.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1477.88 446 L 1470.88 449.5 L 1472.63 446 L 1470.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 1934 446 L 2003.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2008.88 446 L 2001.88 449.5 L 2003.63 446 L 2001.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 2243 446 L 2326.63 446" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2331.88 446 L 2324.88 449.5 L 2326.63 446 L 2324.88 442.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><path d="M 2243 446 L 2280 446 Q 2290 446 2290 456 L 2290 520 Q 2290 530 2300 530 L 2326.63 530" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2331.88 530 L 2324.88 533.5 L 2326.63 530 L 2324.88 526.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="all"/><rect x="32" y="30" width="210" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">Consul 服务端KV 实现</div></div></div></foreignObject><text x="34" y="50" fill="#000000" font-family="source code pro" font-size="18px">Consul 服务端KV 实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>