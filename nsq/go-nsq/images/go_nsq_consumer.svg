<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="3059px" height="1059px" viewBox="-0.5 -0.5 3059 1059" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-03-30T14:07:16.511Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;t4fCCB-W8p7t_DkZ04LS&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;oGucsrLcF5Y8RihhOa70&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-2155-282-325-26-0"><rect x="2155" y="282" width="325" height="26"/></clipPath><clipPath id="mx-clip-1555-121-295-26-0"><rect x="1555" y="121" width="295" height="26"/></clipPath><clipPath id="mx-clip-1555-147-295-26-0"><rect x="1555" y="147" width="295" height="26"/></clipPath><clipPath id="mx-clip-1555-173-295-26-0"><rect x="1555" y="173" width="295" height="26"/></clipPath><clipPath id="mx-clip-1555-199-295-26-0"><rect x="1555" y="199" width="295" height="26"/></clipPath></defs><g><path d="M 2150 259.5 L 2112.7 259.5 Q 2102.7 259.5 2102.7 269.5 L 2102.7 289 Q 2102.7 299 2092.7 299 L 2061.62 299" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2056.37 299 L 2063.37 295.5 L 2061.62 299 L 2063.37 302.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="all"/><path d="M 2150 277 L 2150 245 L 2480 245 L 2480 277" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 2150 277 L 2150 303 L 2480 303 L 2480 277" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2150 277 L 2480 277" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="2156.5" y="258">&lt;&lt;interface&gt;&gt;</text><text x="2156.5" y="274">Handler</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2155-282-325-26-0)" font-size="13px"><text x="2156.5" y="295.5">+ HandleMessage(message *Message) error</text></g><path d="M 1550 116 L 1550 90 L 1850 90 L 1850 116" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1550 116 L 1550 220 L 1850 220 L 1850 116" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1550 116 L 1850 116" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1556.5" y="108">Consumer</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1555-121-295-26-0)" font-size="13px"><text x="1556.5" y="134.5">- topic: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1555-147-295-26-0)" font-size="13px"><text x="1556.5" y="160.5">- channel: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1555-173-295-26-0)" font-size="13px"><text x="1556.5" y="186.5">- incomingMessages: chan</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1555-199-295-26-0)" font-size="13px"><text x="1556.5" y="212.5">- nsqdTCPAddrs: []string</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 135px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 创建消费者</div></div></div></foreignObject><text x="22" y="139" fill="#000000" font-family="source code pro" font-size="13px">1. 创建消费者</text></switch></g><rect x="20" y="155" width="470" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 185px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">consumer, err := nsq.NewConsumer(topic, *channel, cfg)</div></div></div></foreignObject><text x="27" y="189" fill="#000000" font-family="source code pro" font-size="13px">consumer, err := nsq.NewConsumer(topic, *channel, cfg)</text></switch></g><rect x="560" y="155" width="370" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 185px; margin-left: 567px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewConsumer(...) (*Consumer, error)</div></div></div></foreignObject><text x="567" y="189" fill="#000000" font-family="source code pro" font-size="13px">func NewConsumer(...) (*Consumer, error)</text></switch></g><path d="M 1550 155 L 1507 155 Q 1497 155 1497 145 L 1497 130 Q 1497 120 1487 120 L 1450.37 120" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1445.12 120 L 1452.12 116.5 L 1450.37 120 L 1452.12 123.5 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><rect x="1074" y="90" width="370" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 150px; margin-left: 1081px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r := &amp;Consumer{<br />    topic:   topic,<br />    channel: channel,<br />    incomingMessages: make(chan *Message),<br />}<br />go r.rdyLoop()</div></div></div></foreignObject><text x="1081" y="154" fill="#000000" font-family="source code pro" font-size="13px">r := &amp;Consumer{...</text></switch></g><rect x="20" y="269" width="260" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 253px; height: 1px; padding-top: 299px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">consumer.AddHandler(...)</div></div></div></foreignObject><text x="27" y="303" fill="#000000" font-family="source code pro" font-size="13px">consumer.AddHandler(...)</text></switch></g><rect x="404" y="269" width="404" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 397px; height: 1px; padding-top: 299px; margin-left: 411px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *Consumer) AddHandler(handler Handler)</div></div></div></foreignObject><text x="411" y="303" fill="#000000" font-family="source code pro" font-size="13px">func (r *Consumer) AddHandler(handler Handler)</text></switch></g><rect x="910" y="269" width="340" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 333px; height: 1px; padding-top: 299px; margin-left: 917px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r.AddConcurrentHandlers(handler, 1)</div></div></div></foreignObject><text x="917" y="303" fill="#000000" font-family="source code pro" font-size="13px">r.AddConcurrentHandlers(handler, 1)</text></switch></g><rect x="1330" y="269" width="250" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 243px; height: 1px; padding-top: 299px; margin-left: 1337px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">go r.handlerLoop(handler)</div></div></div></foreignObject><text x="1337" y="303" fill="#000000" font-family="source code pro" font-size="13px">go r.handlerLoop(handler)</text></switch></g><path d="M 2055.25 326 L 3020 326 Q 3030 326 3030 336 L 3030 1020 Q 3030 1030 3020 1030 L 1199.5 1030 Q 1189.5 1030 1189.5 1020 L 1189.5 896.37" fill="none" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 1189.5 891.12 L 1193 898.12 L 1189.5 896.37 L 1186 898.12 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="1673.75" y="245" width="381.5" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 375px; height: 1px; padding-top: 299px; margin-left: 1681px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    message, ok := &lt;-r.incomingMessages<br />    err := handler.HandleMessage(message)<br />    message.Finish()<br />}</div></div></div></foreignObject><text x="1681" y="303" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><path d="M 490 185 L 553.63 185" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 558.88 185 L 551.88 188.5 L 553.63 185 L 551.88 181.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 930 185 L 992 185 Q 1002 185 1002 175 L 1002 160 Q 1002 150 1012 150 L 1067.63 150" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1072.88 150 L 1065.88 153.5 L 1067.63 150 L 1065.88 146.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 280 299 L 397.63 299" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 402.88 299 L 395.88 302.5 L 397.63 299 L 395.88 295.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 808 299 L 903.63 299" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 908.88 299 L 901.88 302.5 L 903.63 299 L 901.88 295.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1250 299 L 1323.63 299" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1328.88 299 L 1321.88 302.5 L 1323.63 299 L 1321.88 295.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1580 299 L 1667.38 299" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1672.63 299 L 1665.63 302.5 L 1667.38 299 L 1665.63 295.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 366px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. 连接Lookupd</div></div></div></foreignObject><text x="22" y="370" fill="#000000" font-family="source code pro" font-size="13px">3. 连接Lookupd</text></switch></g><rect x="20" y="382" width="470" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 412px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err = consumer.ConnectToNSQLookupds(lookupdHTTPAddrs)</div></div></div></foreignObject><text x="27" y="416" fill="#000000" font-family="source code pro" font-size="13px">err = consumer.ConnectToNSQLookupds(lookupdHTTPAddrs)</text></switch></g><rect x="560" y="382" width="448" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 441px; height: 1px; padding-top: 412px; margin-left: 567px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *Consumer) ConnectToNSQLookupd(addr string)</div></div></div></foreignObject><text x="567" y="416" fill="#000000" font-family="source code pro" font-size="13px">func (r *Consumer) ConnectToNSQLookupd(addr string)</text></switch></g><rect x="1130" y="376" width="470" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 412px; margin-left: 1137px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r.lookupdHTTPAddrs = append(r.lookupdHTTPAddrs, addr)<br />r.queryLookupd()</div></div></div></foreignObject><text x="1137" y="416" fill="#000000" font-family="source code pro" font-size="13px">r.lookupdHTTPAddrs = append(r.lookupdHTTPAddrs, addr)...</text></switch></g><rect x="1673.75" y="382" width="322" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 315px; height: 1px; padding-top: 412px; margin-left: 1681px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *Consumer) queryLookupd()</div></div></div></foreignObject><text x="1681" y="416" fill="#000000" font-family="source code pro" font-size="13px">func (r *Consumer) queryLookupd()</text></switch></g><rect x="2150" y="340" width="470" height="144" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 412px; margin-left: 2157px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := apiRequestNegotiateV1("GET", endpoint, nil, &amp;data)<br /><br />for _, producer := range data.Producers {<br />    nsqdAddrs = append(nsqdAddrs, joined)<br />}<br /><br />for _, addr := range nsqdAddrs {<br />    err = r.ConnectToNSQD(addr)<br />}</div></div></div></foreignObject><text x="2157" y="416" fill="#000000" font-family="source code pro" font-size="13px">err := apiRequestNegotiateV1("GET", endpoint, nil, &amp;data)...</text></switch></g><path d="M 490 412 L 553.63 412" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 558.88 412 L 551.88 415.5 L 553.63 412 L 551.88 408.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008 412 L 1123.63 412" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128.88 412 L 1121.88 415.5 L 1123.63 412 L 1121.88 408.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1600 412 L 1667.38 412" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1672.63 412 L 1665.63 415.5 L 1667.38 412 L 1665.63 408.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1995.75 412 L 2143.63 412" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2148.88 412 L 2141.88 415.5 L 2143.63 412 L 2141.88 408.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 486px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">4. 连接NSQD</div></div></div></foreignObject><text x="22" y="490" fill="#000000" font-family="source code pro" font-size="13px">4. 连接NSQD</text></switch></g><rect x="20" y="500" width="370" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 530px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err = consumer.ConnectToNSQDs(nsqdTCPAddrs)</div></div></div></foreignObject><text x="27" y="534" fill="#000000" font-family="source code pro" font-size="13px">err = consumer.ConnectToNSQDs(nsqdTCPAddrs)</text></switch></g><path d="M 980 530 L 1045 530 Q 1055 530 1055 540 L 1055 642 Q 1055 652 1065 652 L 1123.63 652" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128.88 652 L 1121.88 655.5 L 1123.63 652 L 1121.88 648.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="490" y="480" width="490" height="100" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 483px; height: 1px; padding-top: 530px; margin-left: 497px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">conn := NewConn(addr, &amp;r.config, &amp;consumerConnDelegate{r})<br />resp, err := conn.Connect()<br /><br />cmd := Subscribe(r.topic, r.channel)<br />err = conn.WriteCommand(cmd)</div></div></div></foreignObject><text x="497" y="534" fill="#000000" font-family="source code pro" font-size="13px">conn := NewConn(addr, &amp;r.config, &amp;consumerConnDelegate{r})...</text></switch></g><rect x="1130" y="500" width="238" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 231px; height: 1px; padding-top: 530px; margin-left: 1137px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewConn(...) *Conn</div></div></div></foreignObject><text x="1137" y="534" fill="#000000" font-family="source code pro" font-size="13px">func NewConn(...) *Conn</text></switch></g><rect x="1497" y="470" width="391" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 384px; height: 1px; padding-top: 530px; margin-left: 1504px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return &amp;Conn{<br />    addr: addr,<br />    delegate: delegate,<br />    cmdChan:         make(chan *Command),<br />    msgResponseChan: make(chan *msgResponse),<br />}</div></div></div></foreignObject><text x="1504" y="534" fill="#000000" font-family="source code pro" font-size="13px">return &amp;Conn{...</text></switch></g><rect x="1130" y="622" width="450" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 443px; height: 1px; padding-top: 652px; margin-left: 1137px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (c *Conn) Connect() (*IdentifyResponse, error)</div></div></div></foreignObject><text x="1137" y="656" fill="#000000" font-family="source code pro" font-size="13px">func (c *Conn) Connect() (*IdentifyResponse, error)</text></switch></g><rect x="1673.75" y="604" width="360" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 353px; height: 1px; padding-top: 652px; margin-left: 1681px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">conn, err := dialer.Dial("tcp", c.addr)<br />c.conn = conn.(*net.TCPConn)<br />go c.readLoop()<br />go c.writeLoop()</div></div></div></foreignObject><text x="1681" y="656" fill="#000000" font-family="source code pro" font-size="13px">conn, err := dialer.Dial("tcp", c.addr)...</text></switch></g><rect x="2212" y="552" width="228" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 221px; height: 1px; padding-top: 582px; margin-left: 2219px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (c *Conn) readLoop()</div></div></div></foreignObject><text x="2219" y="586" fill="#000000" font-family="source code pro" font-size="13px">func (c *Conn) readLoop()</text></switch></g><path d="M 2990 582 L 3000 582 Q 3010 582 3010 592 L 3010 1000 Q 3010 1010 3000 1010 L 1647 1010 Q 1637 1010 1637 1003.18 L 1637 996.37" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1637 991.12 L 1640.5 998.12 L 1637 996.37 L 1633.5 998.12 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><rect x="2570" y="510" width="420" height="144" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 413px; height: 1px; padding-top: 582px; margin-left: 2577px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    frameType, data, err := ReadUnpackedResponse(c)<br />    switch frameType {<br />    case FrameTypeMessage:<br />        msg, err := DecodeMessage(data)<br />        c.delegate.OnMessage(c, msg)<br />    }<br />}</div></div></div></foreignObject><text x="2577" y="586" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><rect x="2212" y="710" width="238" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 231px; height: 1px; padding-top: 740px; margin-left: 2219px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (c *Conn) writeLoop()</div></div></div></foreignObject><text x="2219" y="744" fill="#000000" font-family="source code pro" font-size="13px">func (c *Conn) writeLoop()</text></switch></g><rect x="2570" y="680" width="390" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 383px; height: 1px; padding-top: 740px; margin-left: 2577px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    select {<br />    case resp := &lt;-c.msgResponseChan:<br />        err := c.WriteCommand(resp.cmd)<br />    }<br />}</div></div></div></foreignObject><text x="2577" y="744" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><path d="M 390 530 L 483.63 530" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 488.88 530 L 481.88 533.5 L 483.63 530 L 481.88 526.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 980 530 L 1123.63 530" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128.88 530 L 1121.88 533.5 L 1123.63 530 L 1121.88 526.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1368 530 L 1490.63 530" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1495.88 530 L 1488.88 533.5 L 1490.63 530 L 1488.88 526.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1580 652 L 1667.38 652" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1672.63 652 L 1665.63 655.5 L 1667.38 652 L 1665.63 648.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2033.75 652 L 2070 652 Q 2080 652 2080 642 L 2080 592 Q 2080 582 2090 582 L 2205.63 582" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2210.88 582 L 2203.88 585.5 L 2205.63 582 L 2203.88 578.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2440 582 L 2563.63 582" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2568.88 582 L 2561.88 585.5 L 2563.63 582 L 2561.88 578.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2033.75 652 L 2070 652 Q 2080 652 2080 662 L 2080 730 Q 2080 740 2090 740 L 2205.63 740" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2210.88 740 L 2203.88 743.5 L 2205.63 740 L 2203.88 736.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2450 740 L 2563.63 740" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2568.88 740 L 2561.88 743.5 L 2563.63 740 L 2561.88 736.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 914px; margin-left: 1499px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">5. NSQD 连接消息读取</div></div></div></foreignObject><text x="1499" y="918" fill="#000000" font-family="source code pro" font-size="13px">5. NSQD 连接消息读取</text></switch></g><rect x="1497" y="930" width="280" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 273px; height: 1px; padding-top: 960px; margin-left: 1504px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">OnMessage(c *Conn, m *Message)</div></div></div></foreignObject><text x="1504" y="964" fill="#000000" font-family="source code pro" font-size="13px">OnMessage(c *Conn, m *Message)</text></switch></g><rect x="1860" y="930" width="232" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 225px; height: 1px; padding-top: 960px; margin-left: 1867px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">d.r.onConnMessage(c, m)</div></div></div></foreignObject><text x="1867" y="964" fill="#000000" font-family="source code pro" font-size="13px">d.r.onConnMessage(c, m)</text></switch></g><rect x="2180" y="930" width="460" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 453px; height: 1px; padding-top: 960px; margin-left: 2187px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *Consumer) onConnMessage(c *Conn, msg *Message)</div></div></div></foreignObject><text x="2187" y="964" fill="#000000" font-family="source code pro" font-size="13px">func (r *Consumer) onConnMessage(c *Conn, msg *Message)</text></switch></g><rect x="2713" y="924" width="277" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 270px; height: 1px; padding-top: 960px; margin-left: 2720px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r.incomingMessages &lt;- msg<br />r.maybeUpdateRDY(c)</div></div></div></foreignObject><text x="2720" y="964" fill="#000000" font-family="source code pro" font-size="13px">r.incomingMessages &lt;- msg...</text></switch></g><rect x="1060" y="830" width="259" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 252px; height: 1px; padding-top: 860px; margin-left: 1067px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (m *Message) Finish()</div></div></div></foreignObject><text x="1067" y="864" fill="#000000" font-family="source code pro" font-size="13px">func (m *Message) Finish()</text></switch></g><rect x="1410" y="830" width="223" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 216px; height: 1px; padding-top: 860px; margin-left: 1417px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">m.Delegate.OnFinish(m)</div></div></div></foreignObject><text x="1417" y="864" fill="#000000" font-family="source code pro" font-size="13px">m.Delegate.OnFinish(m)</text></switch></g><rect x="1725" y="830" width="475" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 468px; height: 1px; padding-top: 860px; margin-left: 1732px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (d *connMessageDelegate) OnFinish(m *Message)</div></div></div></foreignObject><text x="1732" y="864" fill="#000000" font-family="source code pro" font-size="13px">func (d *connMessageDelegate) OnFinish(m *Message)</text></switch></g><rect x="2280" y="830" width="223" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 216px; height: 1px; padding-top: 860px; margin-left: 2287px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">d.c.onMessageFinish(m)</div></div></div></foreignObject><text x="2287" y="864" fill="#000000" font-family="source code pro" font-size="13px">d.c.onMessageFinish(m)</text></switch></g><path d="M 2960 860 L 2980 860 Q 2990 860 2990 850 L 2990 750 Q 2990 740 2980 740 L 2966.37 740" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 2961.12 740 L 2968.12 736.5 L 2966.37 740 L 2968.12 743.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="2620" y="830" width="340" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 333px; height: 1px; padding-top: 860px; margin-left: 2627px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">c.msgResponseChan &lt;- &amp;msgResponse{...}</div></div></div></foreignObject><text x="2627" y="864" fill="#000000" font-family="source code pro" font-size="13px">c.msgResponseChan &lt;- &amp;msgResponse{...}</text></switch></g><path d="M 1777 960 L 1853.63 960" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1858.88 960 L 1851.88 963.5 L 1853.63 960 L 1851.88 956.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2092 960 L 2173.63 960" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2178.88 960 L 2171.88 963.5 L 2173.63 960 L 2171.88 956.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2640 960 L 2706.63 960" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2711.88 960 L 2704.88 963.5 L 2706.63 960 L 2704.88 956.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1319 860 L 1403.63 860" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1408.88 860 L 1401.88 863.5 L 1403.63 860 L 1401.88 856.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1633 860 L 1718.63 860" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1723.88 860 L 1716.88 863.5 L 1718.63 860 L 1716.88 856.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2200 860 L 2273.63 860" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2278.88 860 L 2271.88 863.5 L 2273.63 860 L 2271.88 856.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2503 860 L 2613.63 860" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2618.88 860 L 2611.88 863.5 L 2613.63 860 L 2611.88 856.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 250px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 添加处理Handler</div></div></div></foreignObject><text x="22" y="254" fill="#000000" font-family="source code pro" font-size="13px">2. 添加处理Handler</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 810px; margin-left: 1062px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">6. 消息处理完成消息</div></div></div></foreignObject><text x="1062" y="814" fill="#000000" font-family="source code pro" font-size="13px">6. 消息处理完成消息</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 35px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; background-color: #ffffff; white-space: nowrap; ">NSQ 消费者实现</div></div></div></foreignObject><text x="22" y="40" fill="#000000" font-family="source code pro" font-size="18px">NSQ 消费者实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>