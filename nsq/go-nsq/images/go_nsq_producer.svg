<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2429px" height="931px" viewBox="-0.5 -0.5 2429 931" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-03-24T10:24:22.943Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;o9WNpdaZ-JPdeDyjBwFy&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;oBpyapY5exYolGn2BZ60&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-1810-161-325-26-0"><rect x="1810" y="161" width="325" height="26"/></clipPath><clipPath id="mx-clip-1810-187-325-26-0"><rect x="1810" y="187" width="325" height="26"/></clipPath><clipPath id="mx-clip-1810-213-325-26-0"><rect x="1810" y="213" width="325" height="26"/></clipPath><clipPath id="mx-clip-1810-239-325-26-0"><rect x="1810" y="239" width="325" height="26"/></clipPath><clipPath id="mx-clip-501-530-229-26-0"><rect x="501" y="530" width="229" height="26"/></clipPath><clipPath id="mx-clip-501-556-229-26-0"><rect x="501" y="556" width="229" height="26"/></clipPath><clipPath id="mx-clip-501-582-229-26-0"><rect x="501" y="582" width="229" height="26"/></clipPath><clipPath id="mx-clip-501-608-229-26-0"><rect x="501" y="608" width="229" height="26"/></clipPath><clipPath id="mx-clip-501-634-229-26-0"><rect x="501" y="634" width="229" height="26"/></clipPath><clipPath id="mx-clip-501-660-229-26-0"><rect x="501" y="660" width="229" height="26"/></clipPath></defs><g><path d="M 1805 156 L 1805 130 L 2135 130 L 2135 156" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1805 156 L 1805 260 L 2135 260 L 2135 156" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1805 156 L 2135 156" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1811.5" y="148">Producer</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1810-161-325-26-0)" font-size="13px"><text x="1811.5" y="174.5">- addr: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1810-187-325-26-0)" font-size="13px"><text x="1811.5" y="200.5">- conn: producerConn</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1810-213-325-26-0)" font-size="13px"><text x="1811.5" y="226.5">- transactionChan: chan</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1810-239-325-26-0)" font-size="13px"><text x="1811.5" y="252.5">- transactions: []*ProducerTransaction</text></g><path d="M 496 525 L 496 499 L 730 499 L 730 525" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 496 525 L 496 681 L 730 681 L 730 525" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 496 525 L 730 525" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="502.5" y="517">Conn</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-530-229-26-0)" font-size="13px"><text x="502.5" y="543.5">- conn: *net.TCPConn</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-556-229-26-0)" font-size="13px"><text x="502.5" y="569.5">- addr: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-582-229-26-0)" font-size="13px"><text x="502.5" y="595.5">- delegate: ConnDelegate</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-608-229-26-0)" font-size="13px"><text x="502.5" y="621.5">- r: io.Reader</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-634-229-26-0)" font-size="13px"><text x="502.5" y="647.5">- w: io.Writer</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-501-660-229-26-0)" font-size="13px"><text x="502.5" y="673.5">- msgResponseChan: chan</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 120px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 发布消息</div></div></div></foreignObject><text x="22" y="124" fill="#000000" font-family="source code pro" font-size="13px">1. 发布消息</text></switch></g><rect x="20" y="135" width="380" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 373px; height: 1px; padding-top: 165px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">producer, err := nsq.NewProducer(addr, cfg)</div></div></div></foreignObject><text x="27" y="169" fill="#000000" font-family="source code pro" font-size="13px">producer, err := nsq.NewProducer(addr, cfg)</text></switch></g><rect x="70" y="210" width="330" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 323px; height: 1px; padding-top: 240px; margin-left: 77px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := producer.Publish(*topic, line)</div></div></div></foreignObject><text x="77" y="244" fill="#000000" font-family="source code pro" font-size="13px">err := producer.Publish(*topic, line)</text></switch></g><rect x="580" y="135" width="550" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 543px; height: 1px; padding-top: 165px; margin-left: 587px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewProducer(addr string, config *Config) (*Producer, error)</div></div></div></foreignObject><text x="587" y="169" fill="#000000" font-family="source code pro" font-size="13px">func NewProducer(addr string, config *Config) (*Producer, error)</text></switch></g><path d="M 1805.99 144.95 L 1768 144.99 Q 1758 145 1758 155 L 1758 183.5 Q 1758 193.5 1748 193.5 L 1717.37 193.5" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 1712.12 193.5 L 1719.12 190 L 1717.37 193.5 L 1719.12 197 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><rect x="1270" y="135" width="441" height="117" rx="14.04" ry="14.04" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 434px; height: 1px; padding-top: 194px; margin-left: 1277px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">p := &amp;Producer{<br />    id: atomic.AddInt64(&amp;instCount, 1),<br />    addr:   addr,<br />    config: *config,<br />    transactionChan: make(chan *ProducerTransaction),<br />}<br />return p, nil</div></div></div></foreignObject><text x="1277" y="197" fill="#000000" font-family="source code pro" font-size="13px">p := &amp;Producer{...</text></switch></g><rect x="580" y="210" width="403" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 396px; height: 1px; padding-top: 240px; margin-left: 587px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return w.sendCommand(Publish(topic, body))</div></div></div></foreignObject><text x="587" y="244" fill="#000000" font-family="source code pro" font-size="13px">return w.sendCommand(Publish(topic, body))</text></switch></g><rect x="613" y="276" width="370" height="72" rx="8.64" ry="8.64" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 312px; margin-left: 620px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">var params = [][]byte{[]byte(topic)}<br />return &amp;Command{[]byte("PUB"), params, body}</div></div></div></foreignObject><text x="620" y="316" fill="#000000" font-family="source code pro" font-size="13px">var params = [][]byte{[]byte(topic)}...</text></switch></g><rect x="1090" y="264" width="400" height="72" rx="8.64" ry="8.64" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 393px; height: 1px; padding-top: 300px; margin-left: 1097px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := w.sendCommandAsync(cmd, doneChan, nil)<br />t := &lt;-doneChan<br />return t.Error</div></div></div></foreignObject><text x="1097" y="304" fill="#000000" font-family="source code pro" font-size="13px">err := w.sendCommandAsync(cmd, doneChan, nil)...</text></switch></g><path d="M 1760 300 L 1862.63 300" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1867.88 300 L 1860.88 303.5 L 1862.63 300 L 1860.88 296.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="1560" y="270" width="200" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 193px; height: 1px; padding-top: 300px; margin-left: 1567px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">sendCommandAsync(...)</div></div></div></foreignObject><text x="1567" y="304" fill="#000000" font-family="source code pro" font-size="13px">sendCommandAsync(...)</text></switch></g><rect x="1869" y="270" width="187" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 180px; height: 1px; padding-top: 300px; margin-left: 1876px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := w.connect()</div></div></div></foreignObject><text x="1876" y="304" fill="#000000" font-family="source code pro" font-size="13px">err := w.connect()</text></switch></g><rect x="1869" y="336" width="266" height="109" rx="13.08" ry="13.08" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 259px; height: 1px; padding-top: 391px; margin-left: 1876px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">t := &amp;ProducerTransaction{<br />    cmd:      cmd,<br />    doneChan: doneChan,<br />    Args:     args,<br />}<br />w.transactionChan &lt;- t:</div></div></div></foreignObject><text x="1876" y="394" fill="#000000" font-family="source code pro" font-size="13px">t := &amp;ProducerTransaction{...</text></switch></g><path d="M 400 165 L 573.63 165" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 578.88 165 L 571.88 168.5 L 573.63 165 L 571.88 161.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1130 165 L 1190 165 Q 1200 165 1200 175 L 1200 184.25 Q 1200 193.5 1210 193.5 L 1263.63 193.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1268.88 193.5 L 1261.88 197 L 1263.63 193.5 L 1261.88 190 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 400 240 L 573.63 240" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 578.88 240 L 571.88 243.5 L 573.63 240 L 571.88 236.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 983 312 L 993 312 Q 1003 312 1003 302 L 1003 265 Q 1003 255 996.18 255 L 989.37 255" fill="none" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 984.12 255 L 991.12 251.5 L 989.37 255 L 991.12 258.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 983 240 L 1030 240 Q 1040 240 1040 250 L 1040 290 Q 1040 300 1050 300 L 1083.63 300" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1088.88 300 L 1081.88 303.5 L 1083.63 300 L 1081.88 296.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1490 300 L 1553.63 300" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1558.88 300 L 1551.88 303.5 L 1553.63 300 L 1551.88 296.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1760 300 L 1800 300 Q 1810 300 1810 310 L 1810 380.5 Q 1810 390.5 1820 390.5 L 1862.63 390.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1867.88 390.5 L 1860.88 394 L 1862.63 390.5 L 1860.88 387 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 401px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 生产者连接NSQD</div></div></div></foreignObject><text x="22" y="405" fill="#000000" font-family="source code pro" font-size="13px">2. 生产者连接NSQD</text></switch></g><path d="M 730 444 L 750 444 Q 760 444 760 454 L 760 654 Q 760 664 770 664 L 816.63 664" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 821.88 664 L 814.88 667.5 L 816.63 664 L 814.88 660.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="20" y="414" width="124" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 444px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">w.connect()</div></div></div></foreignObject><text x="27" y="448" fill="#000000" font-family="source code pro" font-size="13px">w.connect()</text></switch></g><path d="M 730 444 L 816.63 444" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 821.88 444 L 814.88 447.5 L 816.63 444 L 814.88 440.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 730 444 L 750 444 Q 760 444 760 454 L 760 506 Q 760 516 770 516 L 816.63 516" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 821.88 516 L 814.88 519.5 L 816.63 516 L 814.88 512.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="823" y="633.5" width="124" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 664px; margin-left: 830px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">router()</div></div></div></foreignObject><text x="830" y="667" fill="#000000" font-family="source code pro" font-size="13px">router()</text></switch></g><rect x="823" y="486" width="150" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 143px; height: 1px; padding-top: 516px; margin-left: 830px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">w.conn.Connect()</div></div></div></foreignObject><text x="830" y="520" fill="#000000" font-family="source code pro" font-size="13px">w.conn.Connect()</text></switch></g><rect x="823" y="414" width="124" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 117px; height: 1px; padding-top: 444px; margin-left: 830px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">NewConn(...)</div></div></div></foreignObject><text x="830" y="448" fill="#000000" font-family="source code pro" font-size="13px">NewConn(...)</text></switch></g><rect x="226.5" y="402" width="503.5" height="84" rx="10.08" ry="10.08" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 497px; height: 1px; padding-top: 444px; margin-left: 234px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">w.conn = NewConn(w.addr, &amp;w.config, &amp;producerConnDelegate{w})<br />_, err := w.conn.Connect()<br />go w.router()</div></div></div></foreignObject><text x="234" y="448" fill="#000000" font-family="source code pro" font-size="13px">w.conn = NewConn(w.addr, &amp;w.config, &amp;producerConnDelegate{w})...</text></switch></g><path d="M 1495 663.5 L 1517.5 663.5 Q 1527.5 663.5 1527.5 653.5 L 1527.5 600 Q 1527.5 590 1537.5 590 L 1553.63 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1558.88 590 L 1551.88 593.5 L 1553.63 590 L 1551.88 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="1055" y="591" width="440" height="145" rx="17.4" ry="17.4" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 433px; height: 1px; padding-top: 664px; margin-left: 1062px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    select {<br />    case t := &lt;-w.transactionChan:<br />        w.transactions = append(w.transactions, t)<br />        err := w.conn.WriteCommand(t.cmd)<br />    case data := &lt;-w.responseChan:<br />        w.popTransaction(FrameTypeResponse, data)<br />    }<br />}</div></div></div></foreignObject><text x="1062" y="667" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><rect x="1055" y="395.5" width="388" height="97" rx="11.64" ry="11.64" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 381px; height: 1px; padding-top: 444px; margin-left: 1062px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return &amp;Conn{<br />    addr: addr,<br />    delegate: delegate,<br />    msgResponseChan: make(chan *msgResponse),<br />}</div></div></div></foreignObject><text x="1062" y="448" fill="#000000" font-family="source code pro" font-size="13px">return &amp;Conn{...</text></switch></g><rect x="1055" y="502" width="325" height="78" rx="9.36" ry="9.36" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 318px; height: 1px; padding-top: 541px; margin-left: 1062px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">conn, err := dialer.Dial("tcp", c.addr)<br />c.conn = conn.(*net.TCPConn)<br />go c.readLoop()<br />go c.writeLoop()</div></div></div></foreignObject><text x="1062" y="545" fill="#000000" font-family="source code pro" font-size="13px">conn, err := dialer.Dial("tcp", c.addr)...</text></switch></g><rect x="1869" y="557" width="241" height="66" rx="7.92" ry="7.92" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 234px; height: 1px; padding-top: 590px; margin-left: 1876px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">_, err := cmd.WriteTo(c)<br />err = c.Flush()</div></div></div></foreignObject><text x="1876" y="594" fill="#000000" font-family="source code pro" font-size="13px">_, err := cmd.WriteTo(c)...</text></switch></g><rect x="2160.75" y="554" width="219.25" height="72" rx="8.64" ry="8.64" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 212px; height: 1px; padding-top: 590px; margin-left: 2168px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n, err := w.Write(c.Name)<br />n, err = w.Write(c.Body)</div></div></div></foreignObject><text x="2168" y="594" fill="#000000" font-family="source code pro" font-size="13px">n, err := w.Write(c.Name)...</text></switch></g><rect x="1560" y="633.5" width="387.5" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 381px; height: 1px; padding-top: 664px; margin-left: 1567px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">popTransaction(frameType int32, data []byte)</div></div></div></foreignObject><text x="1567" y="667" fill="#000000" font-family="source code pro" font-size="13px">popTransaction(frameType int32, data []byte)</text></switch></g><rect x="1790" y="703" width="320" height="84" rx="10.08" ry="10.08" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 313px; height: 1px; padding-top: 745px; margin-left: 1797px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">t := w.transactions[0]<br />w.transactions = w.transactions[1:]<br />t.finish()</div></div></div></foreignObject><text x="1797" y="749" fill="#000000" font-family="source code pro" font-size="13px">t := w.transactions[0]...</text></switch></g><path d="M 2360.75 745 L 2390 745 Q 2400 745 2400 735 L 2400 530 Q 2400 520 2390 520 L 1550 520 Q 1540 520 1540 510 L 1540 328 Q 1540 318 1530 318 L 1496.37 318" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 1491.12 318 L 1498.12 314.5 L 1496.37 318 L 1498.12 321.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="2160.75" y="710" width="200" height="70" rx="8.4" ry="8.4" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 193px; height: 1px; padding-top: 745px; margin-left: 2168px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">if t.doneChan != nil {<br />    t.doneChan &lt;- t<br />}</div></div></div></foreignObject><text x="2168" y="749" fill="#000000" font-family="source code pro" font-size="13px">if t.doneChan != nil {...</text></switch></g><path d="M 144 444 L 220.13 444" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 225.38 444 L 218.38 447.5 L 220.13 444 L 218.38 440.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 947 663.5 L 1048.63 663.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1053.88 663.5 L 1046.88 667 L 1048.63 663.5 L 1046.88 660 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 947 444 L 1048.63 444" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1053.88 444 L 1046.88 447.5 L 1048.63 444 L 1046.88 440.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 973 516 L 1004 516 Q 1014 516 1014 526 L 1014 533.5 Q 1014 541 1024 541 L 1048.63 541" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1053.88 541 L 1046.88 544.5 L 1048.63 541 L 1046.88 537.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1790 590 L 1862.63 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1867.88 590 L 1860.88 593.5 L 1862.63 590 L 1860.88 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2110 590 L 2154.38 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2159.63 590 L 2152.63 593.5 L 2154.38 590 L 2152.63 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1495 663.5 L 1510 663.5 Q 1520 663.5 1530 663.5 L 1553.63 663.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1558.88 663.5 L 1551.88 667 L 1553.63 663.5 L 1551.88 660 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1656.88 693.5 L 1656.9 735 Q 1656.9 745 1666.9 745 L 1783.63 745" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1788.88 745 L 1781.88 748.5 L 1783.63 745 L 1781.88 741.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2110 745 L 2154.38 745" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2159.63 745 L 2152.63 748.5 L 2154.38 745 L 2152.63 741.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 736px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. 响应读取 readLoop</div></div></div></foreignObject><text x="22" y="740" fill="#000000" font-family="source code pro" font-size="13px">3. 响应读取 readLoop</text></switch></g><rect x="20" y="752" width="115" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 782px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">readLoop()</div></div></div></foreignObject><text x="27" y="786" fill="#000000" font-family="source code pro" font-size="13px">readLoop()</text></switch></g><rect x="235" y="752" width="455" height="158" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 448px; height: 1px; padding-top: 831px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    frameType, data, err := ReadUnpackedResponse(c)<br />    switch frameType {<br />    case FrameTypeResponse:<br />        c.delegate.OnResponse(c, data)<br />    case FrameTypeError:<br />        c.delegate.OnError(c, data)<br />    }<br />}</div></div></div></foreignObject><text x="242" y="835" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><rect x="823" y="801" width="277" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 270px; height: 1px; padding-top: 831px; margin-left: 830px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">OnResponse(c *Conn, data []byte)</div></div></div></foreignObject><text x="830" y="835" fill="#000000" font-family="source code pro" font-size="13px">OnResponse(c *Conn, data []byte)</text></switch></g><rect x="1156" y="801" width="268" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 261px; height: 1px; padding-top: 831px; margin-left: 1163px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">d.w.onConnResponse(c, data)</div></div></div></foreignObject><text x="1163" y="835" fill="#000000" font-family="source code pro" font-size="13px">d.w.onConnResponse(c, data)</text></switch></g><path d="M 1520 801 L 1520 709.8 Q 1520 699.8 1510.68 699.78 L 1501.37 699.76" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 1496.12 699.75 L 1503.12 696.27 L 1501.37 699.76 L 1503.11 703.27 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="1520" y="801" width="211" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 204px; height: 1px; padding-top: 831px; margin-left: 1527px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">w.responseChan &lt;- data</div></div></div></foreignObject><text x="1527" y="835" fill="#000000" font-family="source code pro" font-size="13px">w.responseChan &lt;- data</text></switch></g><path d="M 135 782 L 175 782 Q 185 782 185 792 L 185 821 Q 185 831 195 831 L 228.63 831" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 233.88 831 L 226.88 834.5 L 228.63 831 L 226.88 827.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 690 831 L 816.63 831" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 821.88 831 L 814.88 834.5 L 816.63 831 L 814.88 827.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1100 831 L 1149.63 831" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1154.88 831 L 1147.88 834.5 L 1149.63 831 L 1147.88 827.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1424 831 L 1513.63 831" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1518.88 831 L 1511.88 834.5 L 1513.63 831 L 1511.88 827.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="1560" y="560" width="230" height="60" rx="7.2" ry="7.2" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 223px; height: 1px; padding-top: 590px; margin-left: 1567px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">WriteCommand(cmd *Command)</div></div></div></foreignObject><text x="1567" y="594" fill="#000000" font-family="source code pro" font-size="13px">WriteCommand(cmd *Command)</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 35px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">NSQ 生产者实现</div></div></div></foreignObject><text x="22" y="40" fill="#000000" font-family="source code pro" font-size="18px">NSQ 生产者实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>