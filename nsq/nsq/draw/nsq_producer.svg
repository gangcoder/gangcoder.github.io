<svg id="SvgjsSvg1006" width="1298.3792419433594" height="677.6704254150391" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1144" markerWidth="16" markerHeight="16" refX="3" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><circle id="SvgjsCircle1145" r="4" cx="8" cy="8" fill="#323232" stroke="#323232" stroke-width="1"></circle></marker><marker id="SvgjsMarker1148" markerWidth="16" markerHeight="16" refX="3" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><circle id="SvgjsCircle1149" r="4" cx="8" cy="8" fill="#323232" stroke="#323232" stroke-width="1"></circle></marker><marker id="SvgjsMarker1152" markerWidth="16" markerHeight="16" refX="3" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><circle id="SvgjsCircle1153" r="4" cx="8" cy="8" fill="#323232" stroke="#323232" stroke-width="1"></circle></marker><marker id="SvgjsMarker1176" markerWidth="12" markerHeight="8" refX="9" refY="4" viewBox="0 0 12 8" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1177" d="M0,0 L12,4 L0,8 L0,0" fill="#6666ff" stroke="#6666ff" stroke-width="1"></path></marker><marker id="SvgjsMarker1180" markerWidth="12" markerHeight="8" refX="9" refY="4" viewBox="0 0 12 8" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1181" d="M0,0 L12,4 L0,8 L0,0" fill="#ff6666" stroke="#ff6666" stroke-width="1"></path></marker><marker id="SvgjsMarker1186" markerWidth="12" markerHeight="8" refX="3" refY="4" viewBox="0 0 12 8" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1187" d="M12,0 L0,4 L12,8 L12,0" fill="#ff6666" stroke="#ff6666" stroke-width="1"></path></marker></defs><g id="SvgjsG1008" transform="translate(580.3380584716797,118.2350340623122)"><path id="SvgjsPath1009" d="M 0 0L 454.6153846153845 0L 454.6153846153845 178.76923076923077L 0 178.76923076923077Z" stroke="none" fill="none"></path><g id="SvgjsG1010"><text id="SvgjsText1011" font-family="微软雅黑" text-anchor="start" font-size="13px" width="455px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1012" dy="16" x="0"><tspan id="SvgjsTspan1013" style="text-decoration:;">type Producer struct {&lt;/br&gt;	id     int64&lt;/br&gt;	addr   string //nsqd tcp 地址</tspan></tspan><tspan id="SvgjsTspan1014" dy="16" x="0"><tspan id="SvgjsTspan1015" style="text-decoration:;">&lt;/br&gt;	conn   producerConn&lt;/br&gt;	&lt;/br&gt;	responseChan chan []byte //收到</tspan></tspan><tspan id="SvgjsTspan1016" dy="16" x="0"><tspan id="SvgjsTspan1017" style="text-decoration:;">响应数据后，数据写入chan&lt;/br&gt;&lt;/br&gt;	transactionChan chan </tspan></tspan><tspan id="SvgjsTspan1018" dy="16" x="0"><tspan id="SvgjsTspan1019" style="text-decoration:;">*ProducerTransaction //消息写入chan&lt;/br&gt;	transactions    </tspan></tspan><tspan id="SvgjsTspan1020" dy="16" x="0"><tspan id="SvgjsTspan1021" style="text-decoration:;">[]*ProducerTransaction //投递中的传输&lt;/br&gt;}</tspan></tspan></text></g></g><g id="SvgjsG1022" transform="translate(25.004725138346373,25.00426483154294)"><path id="SvgjsPath1023" d="M 0 0L 230.33333333333331 0L 230.33333333333331 34.00000000000003L 0 34.00000000000003Z" stroke="none" fill="none"></path><g id="SvgjsG1024"><text id="SvgjsText1025" font-family="微软雅黑" text-anchor="start" font-size="23px" width="231px" fill="#323232" font-weight="700" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="23px" weight="700" font-style="" opacity="1" y="-4.875" transform="rotate(0)"><tspan id="SvgjsTspan1026" dy="28" x="0"><tspan id="SvgjsTspan1027" style="text-decoration:;">NSQ producer</tspan></tspan></text></g></g><g id="SvgjsG1028" transform="translate(53.33805847167969,111.00426483154297)"><path id="SvgjsPath1029" d="M 0 0L 332 0L 332 65L 0 65Z" stroke="none" fill="none"></path><g id="SvgjsG1030"><text id="SvgjsText1031" font-family="微软雅黑" text-anchor="start" font-size="13px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1032" dy="16" x="0"><tspan id="SvgjsTspan1033" style="text-decoration:;">nsq.NewProducer(addr, cfg)</tspan></tspan></text></g></g><g id="SvgjsG1034" transform="translate(53.33805847167969,160.00426483154297)"><path id="SvgjsPath1035" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1036"><text id="SvgjsText1037" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1038" dy="16" x="0"><tspan id="SvgjsTspan1039" style="text-decoration:;">r.ReadBytes(delim)</tspan></tspan></text></g></g><g id="SvgjsG1040" transform="translate(53.33805847167969,208.00426483154297)"><path id="SvgjsPath1041" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1042"><text id="SvgjsText1043" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1044" dy="16" x="0"><tspan id="SvgjsTspan1045" style="text-decoration:;">Publish(*topic, line)</tspan></tspan></text></g></g><g id="SvgjsG1046" transform="translate(115.33805847167969,252.00426483154297)"><path id="SvgjsPath1047" d="M 0 0L 321 0L 321 24L 0 24Z" stroke="none" fill="none"></path><g id="SvgjsG1048"><text id="SvgjsText1049" font-family="微软雅黑" text-anchor="start" font-size="13px" width="321px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1050" dy="16" x="0"><tspan id="SvgjsTspan1051" style="text-decoration:;">&amp;Command{[]byte("PUB"), params, body}</tspan></tspan></text></g></g><g id="SvgjsG1052" transform="translate(115.33805847167969,288.00426483154297)"><path id="SvgjsPath1053" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1054"><text id="SvgjsText1055" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1056" dy="16" x="0"><tspan id="SvgjsTspan1057" style="text-decoration:;">sendCommandAsync</tspan></tspan></text></g></g><g id="SvgjsG1058" transform="translate(174.3380584716797,337.00426483154297)"><path id="SvgjsPath1059" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1060"><text id="SvgjsText1061" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1062" dy="16" x="0"><tspan id="SvgjsTspan1063" style="text-decoration:;">Producer.connect&lt;/br&gt;</tspan></tspan></text></g></g><g id="SvgjsG1064" transform="translate(383.56028069390175,342.1636072794594)"><path id="SvgjsPath1065" d="M 0 0L 476 0L 476 58.5L 0 58.5Z" stroke="none" fill="none"></path><g id="SvgjsG1066"><text id="SvgjsText1067" font-family="微软雅黑" text-anchor="start" font-size="13px" width="476px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1068" dy="16" x="0"><tspan id="SvgjsTspan1069" style="text-decoration:;">w.conn = NewConn(w.addr, &amp;w.config, &amp;producerConnDelegate{w})&lt;/br&gt;</tspan></tspan><tspan id="SvgjsTspan1070" dy="16" x="0"><tspan id="SvgjsTspan1071" style="text-decoration:;">&lt;/br&gt;_, err := w.conn.Connect()</tspan></tspan></text></g></g><g id="SvgjsG1072" transform="translate(174.3380584716797,394.00426483154297)"><path id="SvgjsPath1073" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1074"><text id="SvgjsText1075" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1076" dy="16" x="0"><tspan id="SvgjsTspan1077" style="text-decoration:;">w.transactionChan &lt;- t</tspan></tspan></text></g></g><g id="SvgjsG1078" transform="translate(511.2269473605686,538.5042648315429)"><path id="SvgjsPath1079" d="M 0 0L 293 0L 293 47L 0 47Z" stroke="none" fill="none"></path><g id="SvgjsG1080"><text id="SvgjsText1081" font-family="微软雅黑" text-anchor="start" font-size="13px" width="293px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1082" dy="16" x="0"><tspan id="SvgjsTspan1083" style="text-decoration:;">(c *Conn) WriteCommand(cmd *Command)</tspan></tspan><tspan id="SvgjsTspan1084" dy="16" x="0"><tspan id="SvgjsTspan1085" style="text-decoration:;">&lt;/br&gt;cmd.WriteTo(c)</tspan></tspan></text></g></g><g id="SvgjsG1086" transform="translate(384.39361402723506,429.4487092759872)"><path id="SvgjsPath1087" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1088"><text id="SvgjsText1089" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1090" dy="16" x="0"><tspan id="SvgjsTspan1091" style="text-decoration:;">go w.router()</tspan></tspan></text></g></g><g id="SvgjsG1092" transform="translate(723.0602806939024,378.11537594265405)"><path id="SvgjsPath1093" d="M 0 0L 234 0L 234 43L 0 43Z" stroke="none" fill="none"></path><g id="SvgjsG1094"><text id="SvgjsText1095" font-family="微软雅黑" text-anchor="start" font-size="13px" width="234px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1096" dy="16" x="0"><tspan id="SvgjsTspan1097" style="text-decoration:;">(c *Conn) Connect()&lt;/br&gt;dialer.Dial</tspan></tspan></text></g></g><g id="SvgjsG1098" transform="translate(720.5602806939027,478.17093149820903)"><path id="SvgjsPath1099" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1100"><text id="SvgjsText1101" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1102" dy="16" x="0"><tspan id="SvgjsTspan1103" style="text-decoration:;">go c.writeLoop()</tspan></tspan></text></g></g><g id="SvgjsG1104" transform="translate(722.6436140272357,434.2820426093207)"><path id="SvgjsPath1105" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1106"><text id="SvgjsText1107" font-family="微软雅黑" text-anchor="start" font-size="13px" width="160px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1108" dy="16" x="0"><tspan id="SvgjsTspan1109" style="text-decoration:;">go c.readLoop()</tspan></tspan></text></g></g><g id="SvgjsG1110" transform="translate(897.382301810041,470.9790025860251)"><path id="SvgjsPath1111" d="M 0 0L 337 0L 337 42L 0 42Z" stroke="none" fill="none"></path><g id="SvgjsG1112"><text id="SvgjsText1113" font-family="微软雅黑" text-anchor="start" font-size="13px" width="337px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1114" dy="16" x="0"><tspan id="SvgjsTspan1115" style="text-decoration:;">frameType, data, err := ReadUnpackedResponse(c)</tspan></tspan><tspan id="SvgjsTspan1116" dy="16" x="0"><tspan id="SvgjsTspan1117" style="text-decoration:;">&lt;/br&gt;c.delegate.OnResponse(c, data)</tspan></tspan></text></g></g><g id="SvgjsG1118" transform="translate(455.56028069390175,490.67093149820937)"><path id="SvgjsPath1119" d="M 0 0L 251 0L 251 46L 0 46Z" stroke="none" fill="none"></path><g id="SvgjsG1120"><text id="SvgjsText1121" font-family="微软雅黑" text-anchor="start" font-size="13px" width="251px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1122" dy="16" x="0"><tspan id="SvgjsTspan1123" style="text-decoration:;">t := &lt;-</tspan></tspan><tspan id="SvgjsTspan1124" dy="16" x="0"><tspan id="SvgjsTspan1125" style="text-decoration:;">w.transactionChan&lt;/br&gt;w.conn.WriteCo</tspan></tspan><tspan id="SvgjsTspan1126" dy="16" x="0"><tspan id="SvgjsTspan1127" style="text-decoration:;">mmand(t.cmd)</tspan></tspan></text></g></g><g id="SvgjsG1128"><path id="SvgjsPath1129" d="M44.24083624945669 82.59654998779297L44.24083624945669 158.0132166544596L44.24083624945669 158.0132166544596L44.24083624945669 233.4298833211264" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1130"><path id="SvgjsPath1131" d="M162.57416958279003 322.59654998779257L162.57416958279003 375.92988332112617L162.57416958279003 375.92988332112617L162.57416958279003 429.26321665445965" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1132"><path id="SvgjsPath1133" d="M440.5602806939021 459.86323919051665L440.5602806939021 549.4337520110298L440.5602806939021 549.4337520110298L440.5602806939021 639.004264831543" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1134"><path id="SvgjsPath1135" d="M369.2408362494568 338.742383321126L369.2408362494568 392.07571665445954L369.2408362494568 392.07571665445954L369.2408362494568 445.409049987793" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1136"><path id="SvgjsPath1137" d="M705.5602806939023 379.67093149820937L705.5602806939023 443.33759816487617L705.5602806939023 443.33759816487617L705.5602806939023 507.00426483154297" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1138"><path id="SvgjsPath1139" d="M560.0741695827901 379.69290415445937L633.4075029161237 379.69290415445937L633.4075029161237 379.69290415445937L706.7408362494572 379.69290415445937" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1140"><path id="SvgjsPath1141" d="M302.8192676220057 338.781190510669L336.15260095533904 338.781190510669L336.15260095533904 338.781190510669L369.4859342886724 338.781190510669" stroke="#990000" stroke-width="1" fill="none"></path></g><g id="SvgjsG1142"><path id="SvgjsPath1143" d="M715.1027643540322 460.94544130213114L955.6909996481501 460.94544130213114L955.6909996481501 460.94544130213114L1196.279234942268 460.94544130213114" stroke="#323232" stroke-width="1" fill="none" marker-start="url(#SvgjsMarker1144)"></path></g><g id="SvgjsG1146"><path id="SvgjsPath1147" d="M715.1027643540319 505.65132365507236L792.2973344897789 505.65132365507236L792.2973344897789 505.65132365507236L869.4919046255258 505.65132365507236" stroke="#323232" stroke-width="1" fill="none" marker-start="url(#SvgjsMarker1148)"></path></g><g id="SvgjsG1150"><path id="SvgjsPath1151" d="M374.10728924091046 454.1581109853891L486.0303661639873 454.1581109853891L486.0303661639873 454.1581109853891L597.9534430870642 454.1581109853891" stroke="#323232" stroke-width="1" fill="none" marker-start="url(#SvgjsMarker1152)"></path></g><g id="SvgjsG1154" transform="translate(455.56028069390175,612.6709314982094)"><path id="SvgjsPath1155" d="M 0 0L 332 0L 332 40.3333333333336L 0 40.3333333333336Z" stroke="none" fill="none"></path><g id="SvgjsG1156"><text id="SvgjsText1157" font-family="微软雅黑" text-anchor="start" font-size="13px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1158" dy="16" x="0"><tspan id="SvgjsTspan1159" style="text-decoration:;">data := &lt;-</tspan></tspan><tspan id="SvgjsTspan1160" dy="16" x="0"><tspan id="SvgjsTspan1161" style="text-decoration:;">w.responseChan&lt;/br&gt;w.popTransaction(FrameTypeR</tspan></tspan><tspan id="SvgjsTspan1162" dy="16" x="0"><tspan id="SvgjsTspan1163" style="text-decoration:;">esponse, data)</tspan></tspan></text></g></g><g id="SvgjsG1164" transform="translate(932.382301810041,534.170931498209)"><path id="SvgjsPath1165" d="M 0 0L 340.9557566616387 0L 340.9557566616387 74.83333333333394L 0 74.83333333333394Z" stroke="none" fill="none"></path><g id="SvgjsG1166"><text id="SvgjsText1167" font-family="微软雅黑" text-anchor="start" font-size="13px" width="341px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan1168" dy="16" x="0"><tspan id="SvgjsTspan1169" style="text-decoration:;">producerConnDelegate:&lt;/br&gt;</tspan></tspan><tspan id="SvgjsTspan1170" dy="16" x="0"><tspan id="SvgjsTspan1171" style="text-decoration:;">&lt;/br&gt;onConnResponse(c *Conn, data []byte)</tspan></tspan><tspan id="SvgjsTspan1172" dy="16" x="0"><tspan id="SvgjsTspan1173" style="text-decoration:;">&lt;/br&gt;w.responseChan &lt;- data </tspan></tspan></text></g></g><g id="SvgjsG1174"><path id="SvgjsPath1175" d="M235.3380584716797 421.00426483154297L332.3380584716797 421.00426483154297L332.3380584716797 512.9790025860251L429.3380584716797 512.9790025860251" stroke-dasharray="8,5" stroke="#6666ff" stroke-width="1" fill="none" marker-end="url(#SvgjsMarker1176)"></path></g><g id="SvgjsG1178"><path id="SvgjsPath1179" d="M920.3380584716797 579.004264831543L836.8380584716797 579.004264831543L836.8380584716797 635.004264831543L753.3380584716797 635.004264831543" stroke-dasharray="8,5" stroke="#ff6666" stroke-width="1" fill="none" marker-end="url(#SvgjsMarker1180)"></path></g><g id="SvgjsG1182"><path id="SvgjsPath1183" d="M797.1027643540322 403.94544130213114L1027.7204114128558 403.94544130213114L1027.7204114128558 403.94544130213114L1258.3380584716797 403.94544130213114" stroke="#323232" stroke-width="1" fill="none"></path></g><g id="SvgjsG1184"><path id="SvgjsPath1185" d="M1047.3380584716797 449.00426483154297C 1047.3380584716797 433.804264831543 1047.3380584716797 426.20426483154296 1047.3380584716797 411.00426483154297" stroke-dasharray="8,5" stroke="#ff6666" stroke-width="1" fill="none" marker-start="url(#SvgjsMarker1186)"></path></g></svg>