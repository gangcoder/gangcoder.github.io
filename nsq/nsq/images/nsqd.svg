<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="3787px" height="1531px" viewBox="-0.5 -0.5 3787 1531" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-04-03T06:22:26.719Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;gL0W_Ao8ngRW9D9fy4nx&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;Zuz-FRnfdzJ7bD3Eh2Zm&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-2119-193-255-26-0"><rect x="2119" y="193" width="255" height="26"/></clipPath><clipPath id="mx-clip-2119-219-255-26-0"><rect x="2119" y="219" width="255" height="26"/></clipPath><clipPath id="mx-clip-2119-245-255-26-0"><rect x="2119" y="245" width="255" height="26"/></clipPath><clipPath id="mx-clip-2119-271-255-26-0"><rect x="2119" y="271" width="255" height="26"/></clipPath><clipPath id="mx-clip-2119-297-255-26-0"><rect x="2119" y="297" width="255" height="26"/></clipPath><clipPath id="mx-clip-301-728-165-26-0"><rect x="301" y="728" width="165" height="26"/></clipPath><clipPath id="mx-clip-2455-193-285-26-0"><rect x="2455" y="193" width="285" height="26"/></clipPath><clipPath id="mx-clip-2455-219-285-26-0"><rect x="2455" y="219" width="285" height="26"/></clipPath><clipPath id="mx-clip-2455-245-285-26-0"><rect x="2455" y="245" width="285" height="26"/></clipPath><clipPath id="mx-clip-2455-271-285-26-0"><rect x="2455" y="271" width="285" height="26"/></clipPath><clipPath id="mx-clip-2819-193-282-26-0"><rect x="2819" y="193" width="282" height="26"/></clipPath><clipPath id="mx-clip-2819-219-282-26-0"><rect x="2819" y="219" width="282" height="26"/></clipPath><clipPath id="mx-clip-2819-245-282-26-0"><rect x="2819" y="245" width="282" height="26"/></clipPath><clipPath id="mx-clip-2819-271-282-26-0"><rect x="2819" y="271" width="282" height="26"/></clipPath></defs><g><path d="M 2114 187.5 L 2114 161.5 L 2374 161.5 L 2374 187.5" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 2114 187.5 L 2114 317.5 L 2374 317.5 L 2374 187.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2114 187.5 L 2374 187.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="2120.5" y="179.5">NSQD</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2119-193-255-26-0)" font-size="13px"><text x="2120.5" y="206">- topicMap: map[string]*Topic</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2119-219-255-26-0)" font-size="13px"><text x="2120.5" y="232">- lookupPeers: atomic.Value</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2119-245-255-26-0)" font-size="13px"><text x="2120.5" y="258">- tcpListener: net.Listener</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2119-271-255-26-0)" font-size="13px"><text x="2120.5" y="284">- httpListener: net.Listener</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2119-297-255-26-0)" font-size="13px"><text x="2120.5" y="310">- ci: *clusterinfo.ClusterInfo</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 152px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. 启动NSQD</div></div></div></foreignObject><text x="29" y="156" fill="#000000" font-family="source code pro" font-size="13px">1. 启动NSQD</text></switch></g><rect x="27" y="172" width="250" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 243px; height: 1px; padding-top: 202px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">nsqd, err := nsqd.New(opts)</div></div></div></foreignObject><text x="34" y="206" fill="#000000" font-family="source code pro" font-size="13px">nsqd, err := nsqd.New(opts)</text></switch></g><rect x="374" y="172" width="210" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 203px; height: 1px; padding-top: 202px; margin-left: 381px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func New(opts *Options)</div></div></div></foreignObject><text x="381" y="206" fill="#000000" font-family="source code pro" font-size="13px">func New(opts *Options)</text></switch></g><rect x="664" y="141.5" width="340" height="121" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 333px; height: 1px; padding-top: 202px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n := &amp;NSQD{<br />    startTime: time.Now(),<br />    topicMap: make(map[string]*Topic),<br />    notifyChan: make(chan interface{}),<br />}<br />httpcli := http_api.NewClient(...)<br />n.ci = clusterinfo.New(n.logf, httpcli)</div></div></div></foreignObject><text x="671" y="206" fill="#000000" font-family="source code pro" font-size="13px">n := &amp;NSQD{...</text></switch></g><rect x="664" y="277" width="460" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 453px; height: 1px; padding-top: 307px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n.tcpListener, err = net.Listen("tcp", opts.TCPAddress)</div></div></div></foreignObject><text x="671" y="311" fill="#000000" font-family="source code pro" font-size="13px">n.tcpListener, err = net.Listen("tcp", opts.TCPAddress)</text></switch></g><rect x="664" y="357" width="470" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 387px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n.httpListener, err = net.Listen("tcp", opts.HTTPAddress)</div></div></div></foreignObject><text x="671" y="391" fill="#000000" font-family="source code pro" font-size="13px">n.httpListener, err = net.Listen("tcp", opts.HTTPAddress)</text></switch></g><rect x="1173" y="167.5" width="198.5" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 192px; height: 1px; padding-top: 198px; margin-left: 1180px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := p.nsqd.Main()</div></div></div></foreignObject><text x="1180" y="201" fill="#000000" font-family="source code pro" font-size="13px">err := p.nsqd.Main()</text></switch></g><rect x="1502" y="161.5" width="456" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 449px; height: 1px; padding-top: 198px; margin-left: 1509px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">tcpServer := &amp;tcpServer{ctx: ctx}<br />go protocol.TCPServer(n.tcpListener, tcpServer, n.logf)</div></div></div></foreignObject><text x="1509" y="201" fill="#000000" font-family="source code pro" font-size="13px">tcpServer := &amp;tcpServer{ctx: ctx}...</text></switch></g><rect x="1502" y="251.5" width="426" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 419px; height: 1px; padding-top: 288px; margin-left: 1509px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">httpServer := newHTTPServer(...)<br />go http_api.Serve(n.httpListener, httpServer, ...)</div></div></div></foreignObject><text x="1509" y="291" fill="#000000" font-family="source code pro" font-size="13px">httpServer := newHTTPServer(...)...</text></switch></g><rect x="1502" y="341.5" width="286" height="65" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 279px; height: 1px; padding-top: 374px; margin-left: 1509px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">n.waitGroup.Wrap(n.queueScanLoop)<br />n.waitGroup.Wrap(n.lookupLoop)<br />n.waitGroup.Wrap(n.statsdLoop)</div></div></div></foreignObject><text x="1509" y="378" fill="#000000" font-family="source code pro" font-size="13px">n.waitGroup.Wrap(n.queueScanLoop)...</text></switch></g><path d="M 277 202 L 367.63 202" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 372.88 202 L 365.88 205.5 L 367.63 202 L 365.88 198.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 584 202 L 657.63 202" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 662.88 202 L 655.88 205.5 L 657.63 202 L 655.88 198.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 584 202 L 594.07 202.03 Q 604.07 202.07 604.07 212.07 L 604.07 297 Q 604.07 307 614.07 307 L 657.63 307" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 662.88 307 L 655.88 310.5 L 657.63 307 L 655.88 303.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 584 202 L 594.07 202.03 Q 604.07 202.07 604.07 212.07 L 604.07 377 Q 604.07 387 614.07 387 L 657.63 387" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 662.88 387 L 655.88 390.5 L 657.63 387 L 655.88 383.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1371.5 197.5 L 1495.63 197.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1500.88 197.5 L 1493.88 201 L 1495.63 197.5 L 1493.88 194 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1371.5 197.5 L 1394.07 197.52 Q 1404.07 197.53 1404.07 207.53 L 1404.07 278.07 Q 1404.07 288.07 1414.07 288.07 L 1495.63 288.07" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1500.88 288.07 L 1493.88 291.57 L 1495.63 288.07 L 1493.88 284.57 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1371.5 197.5 L 1394.07 197.52 Q 1404.07 197.53 1404.07 207.53 L 1404.07 364.07 Q 1404.07 374.07 1414.07 374.07 L 1495.63 374.07" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1500.88 374.07 L 1493.88 377.57 L 1495.63 374.07 L 1493.88 370.57 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 437px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. http 监听</div></div></div></foreignObject><text x="29" y="441" fill="#000000" font-family="source code pro" font-size="13px">2. http 监听</text></switch></g><rect x="27" y="457" width="210" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 203px; height: 1px; padding-top: 487px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func newHTTPServer(...)</div></div></div></foreignObject><text x="34" y="491" fill="#000000" font-family="source code pro" font-size="13px">func newHTTPServer(...)</text></switch></g><rect x="338" y="442.5" width="240" height="89" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 233px; height: 1px; padding-top: 487px; margin-left: 345px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">router := httprouter.New()<br />s := &amp;httpServer{<br />    ctx:         ctx,<br />    router:      router,<br />}</div></div></div></foreignObject><text x="345" y="491" fill="#000000" font-family="source code pro" font-size="13px">router := httprouter.New()...</text></switch></g><rect x="698" y="565" width="190" height="50" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 183px; height: 1px; padding-top: 590px; margin-left: 705px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">"/stats", s.doStats</div></div></div></foreignObject><text x="705" y="594" fill="#000000" font-family="source code pro" font-size="13px">"/stats", s.doStats</text></switch></g><rect x="988" y="457" width="115" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 487px; margin-left: 995px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">doPUB(...)</div></div></div></foreignObject><text x="995" y="491" fill="#000000" font-family="source code pro" font-size="13px">doPUB(...)</text></switch></g><rect x="1202" y="448.5" width="414.5" height="77" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 408px; height: 1px; padding-top: 487px; margin-left: 1209px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">reqParams, topic, err := s.getTopicFromQuery(req)<br />msg := NewMessage(topic.GenerateID(), body)<br />err = topic.PutMessage(msg)</div></div></div></foreignObject><text x="1209" y="491" fill="#000000" font-family="source code pro" font-size="13px">reqParams, topic, err := s.getTopicFromQuery(req)...</text></switch></g><rect x="1702" y="457" width="210" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 203px; height: 1px; padding-top: 487px; margin-left: 1709px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">PutMessage(m *Message)</div></div></div></foreignObject><text x="1709" y="491" fill="#000000" font-family="source code pro" font-size="13px">PutMessage(m *Message)</text></switch></g><rect x="2002" y="457" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 487px; margin-left: 2009px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := t.put(m)</div></div></div></foreignObject><text x="2009" y="491" fill="#000000" font-family="source code pro" font-size="13px">err := t.put(m)</text></switch></g><rect x="2252" y="457" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 487px; margin-left: 2259px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">put(m *Message)</div></div></div></foreignObject><text x="2259" y="491" fill="#000000" font-family="source code pro" font-size="13px">put(m *Message)</text></switch></g><rect x="2489" y="453.5" width="230" height="67" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 223px; height: 1px; padding-top: 487px; margin-left: 2496px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">select {<br />case t.memoryMsgChan &lt;- m:<br />}</div></div></div></foreignObject><text x="2496" y="491" fill="#000000" font-family="source code pro" font-size="13px">select {...</text></switch></g><rect x="988" y="560" width="133" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 126px; height: 1px; padding-top: 590px; margin-left: 995px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">doStats(...)</div></div></div></foreignObject><text x="995" y="594" fill="#000000" font-family="source code pro" font-size="13px">doStats(...)</text></switch></g><rect x="1202" y="542" width="371" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 364px; height: 1px; padding-top: 590px; margin-left: 1209px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topicName, _ := reqParams.Get("topic")<br />channelName, _ := reqParams.Get("channel")<br />stats := s.ctx.nsqd.GetStats(...)<br />ms := getMemStats()</div></div></div></foreignObject><text x="1209" y="594" fill="#000000" font-family="source code pro" font-size="13px">topicName, _ := reqParams.Get("topic")...</text></switch></g><path d="M 237 487 L 331.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 336.88 487 L 329.88 490.5 L 331.63 487 L 329.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 578 487 L 691.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 696.88 487 L 689.88 490.5 L 691.63 487 L 689.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 578 487 L 604.07 487 Q 614.07 487 614.07 497 L 614.07 580.07 Q 614.07 590.07 624.07 590.07 L 691.63 590.07" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 696.88 590.07 L 689.88 593.57 L 691.63 590.07 L 689.88 586.57 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 868 487 L 981.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 986.88 487 L 979.88 490.5 L 981.63 487 L 979.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1103 487 L 1195.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1200.88 487 L 1193.88 490.5 L 1195.63 487 L 1193.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1616.5 487 L 1695.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1700.88 487 L 1693.88 490.5 L 1695.63 487 L 1693.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1912 487 L 1995.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2000.88 487 L 1993.88 490.5 L 1995.63 487 L 1993.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2162 487 L 2245.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2250.88 487 L 2243.88 490.5 L 2245.63 487 L 2243.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2412 487 L 2482.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2487.88 487 L 2480.88 490.5 L 2482.63 487 L 2480.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 888 590 L 981.63 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 986.88 590 L 979.88 593.5 L 981.63 590 L 979.88 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1121 590 L 1195.63 590" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1200.88 590 L 1193.88 593.5 L 1195.63 590 L 1193.88 586.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 591px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. tcp 监听</div></div></div></foreignObject><text x="29" y="595" fill="#000000" font-family="source code pro" font-size="13px">3. tcp 监听</text></switch></g><rect x="27" y="611" width="196" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 189px; height: 1px; padding-top: 641px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func TCPServer(...)</div></div></div></foreignObject><text x="34" y="645" fill="#000000" font-family="source code pro" font-size="13px">func TCPServer(...)</text></switch></g><path d="M 614 640.5 L 624.07 640.48 Q 634.07 640.47 634.07 650.47 L 634.07 692.47 Q 634.07 702.47 624.07 702.47 L 472.37 702.5" fill="none" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 467.12 702.5 L 474.12 699 L 472.37 702.5 L 474.12 706 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="296" y="610" width="318" height="61" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 311px; height: 1px; padding-top: 641px; margin-left: 303px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">clientConn, err := listener.Accept()<br />go handler.Handle(clientConn)</div></div></div></foreignObject><text x="303" y="644" fill="#000000" font-family="source code pro" font-size="13px">clientConn, err := listener.Accept()...</text></switch></g><rect x="540.5" y="706" width="240.5" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 234px; height: 1px; padding-top: 736px; margin-left: 548px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Handle(clientConn net.Conn)</div></div></div></foreignObject><text x="548" y="740" fill="#000000" font-family="source code pro" font-size="13px">Handle(clientConn net.Conn)</text></switch></g><rect x="847.5" y="703" width="280.5" height="66" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 274px; height: 1px; padding-top: 736px; margin-left: 855px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">prot = &amp;protocolV2{ctx: p.ctx}<br />err = prot.IOLoop(clientConn)</div></div></div></foreignObject><text x="855" y="740" fill="#000000" font-family="source code pro" font-size="13px">prot = &amp;protocolV2{ctx: p.ctx}...</text></switch></g><rect x="1194" y="706" width="200" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 193px; height: 1px; padding-top: 736px; margin-left: 1201px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">IOLoop(conn net.Conn)</div></div></div></foreignObject><text x="1201" y="740" fill="#000000" font-family="source code pro" font-size="13px">IOLoop(conn net.Conn)</text></switch></g><rect x="1494" y="706" width="370" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 736px; margin-left: 1501px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">client := newClientV2(clientID, conn, p.ctx)</div></div></div></foreignObject><text x="1501" y="740" fill="#000000" font-family="source code pro" font-size="13px">client := newClientV2(clientID, conn, p.ctx)</text></switch></g><rect x="1494" y="777" width="430" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 423px; height: 1px; padding-top: 807px; margin-left: 1501px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">go p.messagePump(client, messagePumpStartedChan)</div></div></div></foreignObject><text x="1501" y="811" fill="#000000" font-family="source code pro" font-size="13px">go p.messagePump(client, messagePumpStartedChan)</text></switch></g><rect x="1494" y="851" width="400" height="90" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 393px; height: 1px; padding-top: 896px; margin-left: 1501px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    line, err = client.Reader.ReadSlice('\n')<br />    params := bytes.Split(line, separatorBytes)<br />    response, err = p.Exec(client, params)<br />}</div></div></div></foreignObject><text x="1501" y="900" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><rect x="1944" y="866" width="330" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 323px; height: 1px; padding-top: 896px; margin-left: 1951px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Exec(client *clientV2, params [][]byte)</div></div></div></foreignObject><text x="1951" y="900" fill="#000000" font-family="source code pro" font-size="13px">Exec(client *clientV2, params [][]byte)</text></switch></g><rect x="2344" y="843.5" width="370" height="105" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 896px; margin-left: 2351px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">switch {<br />case bytes.Equal(params[0], []byte("RDY")):<br />    return p.RDY(client, params)<br />case bytes.Equal(params[0], []byte("PUB")):<br />    return p.PUB(client, params)<br />}</div></div></div></foreignObject><text x="2351" y="900" fill="#000000" font-family="source code pro" font-size="13px">switch {...</text></switch></g><rect x="2854" y="866" width="330" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 323px; height: 1px; padding-top: 896px; margin-left: 2861px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">PUB(client *clientV2, params [][]byte)</div></div></div></foreignObject><text x="2861" y="900" fill="#000000" font-family="source code pro" font-size="13px">PUB(client *clientV2, params [][]byte)</text></switch></g><rect x="3319" y="846.5" width="425" height="99" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 418px; height: 1px; padding-top: 896px; margin-left: 3326px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topicName := string(params[1])<br />_, err = io.ReadFull(client.Reader, messageBody)<br />topic := p.ctx.nsqd.GetTopic(topicName)<br /><br />msg := NewMessage(topic.GenerateID(), messageBody)<br />err = topic.PutMessage(msg)</div></div></div></foreignObject><text x="3326" y="900" fill="#000000" font-family="source code pro" font-size="13px">topicName := string(params[1])...</text></switch></g><rect x="2854" y="977" width="367" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 360px; height: 1px; padding-top: 1007px; margin-left: 2861px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">SUB(client *clientV2, params [][]byte)</div></div></div></foreignObject><text x="2861" y="1011" fill="#000000" font-family="source code pro" font-size="13px">SUB(client *clientV2, params [][]byte)</text></switch></g><path d="M 3662 1030.75 L 3754.07 1030.86 Q 3764.07 1030.87 3764.07 1020.87 L 3764.07 665 Q 3764.07 655 3754.07 655 L 2618.37 655" fill="none" stroke="#019ed5" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 2613.12 655 L 2620.12 651.5 L 2618.37 655 L 2620.12 658.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="3319" y="959.5" width="343" height="95" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 336px; height: 1px; padding-top: 1007px; margin-left: 3326px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topic := p.ctx.nsqd.GetTopic(topicName)<br />channel = topic.GetChannel(channelName)<br /><br />channel.AddClient(client.ID, client)<br />client.Channel = channel<br />client.SubEventChan &lt;- channel</div></div></div></foreignObject><text x="3326" y="1011" fill="#000000" font-family="source code pro" font-size="13px">topic := p.ctx.nsqd.GetTopic(topicName)...</text></switch></g><rect x="2002" y="689" width="169" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 162px; height: 1px; padding-top: 719px; margin-left: 2009px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">messagePump(...)</div></div></div></foreignObject><text x="2009" y="723" fill="#000000" font-family="source code pro" font-size="13px">messagePump(...)</text></switch></g><rect x="2234" y="635" width="378" height="168" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 371px; height: 1px; padding-top: 719px; margin-left: 2241px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">subEventChan := client.SubEventChan<br />for {<br />    memoryMsgChan = subChannel.memoryMsgChan<br />    select {<br />    case subChannel = &lt;-subEventChan:<br />    case msg := &lt;-memoryMsgChan:<br />        msg.Attempts++<br />        err = p.SendMessage(client, msg)<br />    }<br />}</div></div></div></foreignObject><text x="2241" y="723" fill="#000000" font-family="source code pro" font-size="13px">subEventChan := client.SubEventChan...</text></switch></g><rect x="2674" y="689" width="169" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 162px; height: 1px; padding-top: 719px; margin-left: 2681px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">SendMessage(...)</div></div></div></foreignObject><text x="2681" y="723" fill="#000000" font-family="source code pro" font-size="13px">SendMessage(...)</text></switch></g><rect x="2894" y="683" width="460" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 453px; height: 1px; padding-top: 719px; margin-left: 2901px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">_, err := msg.WriteTo(buf)<br />err = p.Send(client, frameTypeMessage, buf.Bytes())</div></div></div></foreignObject><text x="2901" y="723" fill="#000000" font-family="source code pro" font-size="13px">_, err := msg.WriteTo(buf)...</text></switch></g><rect x="2984.5" y="777" width="106" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 99px; height: 1px; padding-top: 807px; margin-left: 2992px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Send(...)</div></div></div></foreignObject><text x="2992" y="811" fill="#000000" font-family="source code pro" font-size="13px">Send(...)</text></switch></g><rect x="3174" y="777" width="570" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 563px; height: 1px; padding-top: 807px; margin-left: 3181px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">_, err := protocol.SendFramedResponse(client.Writer, frameType, data)</div></div></div></foreignObject><text x="3181" y="811" fill="#000000" font-family="source code pro" font-size="13px">_, err := protocol.SendFramedResponse(client.Writer, frameType, data)</text></switch></g><path d="M 223 641 L 249.53 641 Q 259.53 641 259.53 640.73 L 259.53 640.6 Q 259.53 640.47 269.53 640.47 L 289.63 640.47" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 294.88 640.47 L 287.88 643.97 L 289.63 640.47 L 287.88 636.97 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 466 736 L 534.13 736" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 539.38 736 L 532.38 739.5 L 534.13 736 L 532.38 732.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 781 736 L 841.13 736" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 846.38 736 L 839.38 739.5 L 841.13 736 L 839.38 732.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128 736 L 1187.63 736" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1192.88 736 L 1185.88 739.5 L 1187.63 736 L 1185.88 732.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1394 736 L 1487.63 736" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1492.88 736 L 1485.88 739.5 L 1487.63 736 L 1485.88 732.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1394 736 L 1414.07 736.04 Q 1424.07 736.07 1424.07 746.07 L 1424.07 797 Q 1424.07 807 1434.07 807 L 1487.63 807" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1492.88 807 L 1485.88 810.5 L 1487.63 807 L 1485.88 803.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1394 736 L 1414.07 736.04 Q 1424.07 736.07 1424.07 746.07 L 1424.07 886.07 Q 1424.07 896.07 1434.07 896.07 L 1487.63 896.07" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1492.88 896.07 L 1485.88 899.57 L 1487.63 896.07 L 1485.88 892.57 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1894 896 L 1937.63 896" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1942.88 896 L 1935.88 899.5 L 1937.63 896 L 1935.88 892.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2274 896 L 2337.63 896" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2342.88 896 L 2335.88 899.5 L 2337.63 896 L 2335.88 892.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2714 896 L 2847.63 896" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2852.88 896 L 2845.88 899.5 L 2847.63 896 L 2845.88 892.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3184 896 L 3312.63 896" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3317.88 896 L 3310.88 899.5 L 3312.63 896 L 3310.88 892.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2714 896 L 2804.07 896.06 Q 2814.07 896.07 2814.07 906.07 L 2814.07 999 Q 2814.07 1009 2824.07 1009 L 2847.63 1009" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2852.88 1009 L 2845.88 1012.5 L 2847.63 1009 L 2845.88 1005.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3221 1007 L 3234.07 1007 Q 3244.07 1007 3254.07 1007 L 3312.63 1007" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3317.88 1007 L 3310.88 1010.5 L 3312.63 1007 L 3310.88 1003.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1924 807 L 1953 807 Q 1963 807 1963 797 L 1963 729 Q 1963 719 1973 719 L 1995.63 719" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2000.88 719 L 1993.88 722.5 L 1995.63 719 L 1993.88 715.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2171 719 L 2227.63 719" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2232.88 719 L 2225.88 722.5 L 2227.63 719 L 2225.88 715.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2612 719 L 2667.63 719" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2672.88 719 L 2665.88 722.5 L 2667.63 719 L 2665.88 715.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2843 719 L 2887.63 719" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2892.88 719 L 2885.88 722.5 L 2887.63 719 L 2885.88 715.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2927.12 756.01 L 2927.13 797 Q 2927.13 807 2937.13 807 L 2978.13 807" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2983.38 807 L 2976.38 810.5 L 2978.13 807 L 2976.38 803.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3090.5 807 L 3167.63 807" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3172.88 807 L 3165.88 810.5 L 3167.63 807 L 3165.88 803.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1035px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">4. Topic 消息分发实现</div></div></div></foreignObject><text x="29" y="1039" fill="#000000" font-family="source code pro" font-size="13px">4. Topic 消息分发实现</text></switch></g><rect x="27" y="1055.25" width="259" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 252px; height: 1px; padding-top: 1085px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">GetTopic(topicName string)</div></div></div></foreignObject><text x="34" y="1089" fill="#000000" font-family="source code pro" font-size="13px">GetTopic(topicName string)</text></switch></g><rect x="386" y="1051.75" width="430" height="67" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 423px; height: 1px; padding-top: 1085px; margin-left: 393px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">t = NewTopic(topicName, &amp;context{n}, deleteCallback)<br />n.topicMap[topicName] = t<br />lookupdHTTPAddrs := n.lookupdHTTPAddrs()</div></div></div></foreignObject><text x="393" y="1089" fill="#000000" font-family="source code pro" font-size="13px">t = NewTopic(topicName, &amp;context{n}, deleteCallback)...</text></switch></g><rect x="386" y="1154.5" width="451" height="70" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 444px; height: 1px; padding-top: 1190px; margin-left: 393px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">channelNames, err := n.ci.GetLookupdTopicChannels(...)<br />for _, channelName := range channelNames {<br />    t.GetChannel(channelName)<br />}</div></div></div></foreignObject><text x="393" y="1193" fill="#000000" font-family="source code pro" font-size="13px">channelNames, err := n.ci.GetLookupdTopicChannels(...)...</text></switch></g><rect x="947" y="1055.25" width="187" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 180px; height: 1px; padding-top: 1085px; margin-left: 954px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewTopic(...)</div></div></div></foreignObject><text x="954" y="1089" fill="#000000" font-family="source code pro" font-size="13px">func NewTopic(...)</text></switch></g><rect x="1224" y="1032.75" width="370" height="105" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 363px; height: 1px; padding-top: 1085px; margin-left: 1231px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">t := &amp;Topic{<br />    name: topicName,<br />    channelMap: make(map[string]*Channel),<br />    memoryMsgChan: make(...),<br />}<br />t.waitGroup.Wrap(t.messagePump)</div></div></div></foreignObject><text x="1231" y="1089" fill="#000000" font-family="source code pro" font-size="13px">t := &amp;Topic{...</text></switch></g><rect x="947" y="1159.5" width="280" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 273px; height: 1px; padding-top: 1190px; margin-left: 954px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">GetChannel(channelName string)</div></div></div></foreignObject><text x="954" y="1193" fill="#000000" font-family="source code pro" font-size="13px">GetChannel(channelName string)</text></switch></g><rect x="1297" y="1159" width="419" height="61" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 412px; height: 1px; padding-top: 1190px; margin-left: 1304px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">channel, isNew := t.getOrCreateChannel(channelName)</div></div></div></foreignObject><text x="1304" y="1193" fill="#000000" font-family="source code pro" font-size="13px">channel, isNew := t.getOrCreateChannel(channelName)</text></switch></g><rect x="1789" y="1159.5" width="335" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 328px; height: 1px; padding-top: 1190px; margin-left: 1796px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">getOrCreateChannel(channelName string)</div></div></div></foreignObject><text x="1796" y="1193" fill="#000000" font-family="source code pro" font-size="13px">getOrCreateChannel(channelName string)</text></switch></g><rect x="2233" y="1153.5" width="540" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 533px; height: 1px; padding-top: 1190px; margin-left: 2240px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">channel = NewChannel(t.name, channelName, t.ctx, deleteCallback)<br />t.channelMap[channelName] = channel</div></div></div></foreignObject><text x="2240" y="1193" fill="#000000" font-family="source code pro" font-size="13px">channel = NewChannel(t.name, channelName, t.ctx, deleteCallback)...</text></switch></g><rect x="2836" y="1159.5" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 1190px; margin-left: 2843px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">NewChannel(...)</div></div></div></foreignObject><text x="2843" y="1193" fill="#000000" font-family="source code pro" font-size="13px">NewChannel(...)</text></switch></g><rect x="3099" y="1137" width="380" height="105" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 373px; height: 1px; padding-top: 1190px; margin-left: 3106px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">c := &amp;Channel{<br />    topicName:      topicName,<br />    name:           channelName,<br />    memoryMsgChan:  make(...),<br />    clients:        make(map[int64]Consumer),<br />}</div></div></div></foreignObject><text x="3106" y="1193" fill="#000000" font-family="source code pro" font-size="13px">c := &amp;Channel{...</text></switch></g><rect x="1668" y="1055.25" width="142" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 135px; height: 1px; padding-top: 1085px; margin-left: 1675px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">messagePump()</div></div></div></foreignObject><text x="1675" y="1089" fill="#000000" font-family="source code pro" font-size="13px">messagePump()</text></switch></g><rect x="1902" y="959" width="350" height="180" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 343px; height: 1px; padding-top: 1049px; margin-left: 1909px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">var chans []*Channel<br />for _, c := range t.channelMap {<br />    chans = append(chans, c)<br />}<br />for {<br />    msg = &lt;- t.memoryMsgChan<br />    for i, channel := range chans {<br />        chanMsg := msg<br />        err := channel.PutMessage(chanMsg)<br />    }<br />}</div></div></div></foreignObject><text x="1909" y="1053" fill="#000000" font-family="source code pro" font-size="13px">var chans []*Channel...</text></switch></g><rect x="2328" y="1055.25" width="200" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 193px; height: 1px; padding-top: 1085px; margin-left: 2335px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">PutMessage(m *Message)</div></div></div></foreignObject><text x="2335" y="1089" fill="#000000" font-family="source code pro" font-size="13px">PutMessage(m *Message)</text></switch></g><rect x="2614" y="1055.25" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 1085px; margin-left: 2621px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">err := c.put(m)</div></div></div></foreignObject><text x="2621" y="1089" fill="#000000" font-family="source code pro" font-size="13px">err := c.put(m)</text></switch></g><rect x="2844" y="1055.25" width="160" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 153px; height: 1px; padding-top: 1085px; margin-left: 2851px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">put(m *Message)</div></div></div></foreignObject><text x="2851" y="1089" fill="#000000" font-family="source code pro" font-size="13px">put(m *Message)</text></switch></g><rect x="3064" y="1053.5" width="240" height="63.5" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 233px; height: 1px; padding-top: 1085px; margin-left: 3071px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">select {<br />case c.memoryMsgChan &lt;- m:<br />}</div></div></div></foreignObject><text x="3071" y="1089" fill="#000000" font-family="source code pro" font-size="13px">select {...</text></switch></g><path d="M 286 1085.25 L 379.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 384.88 1085.25 L 377.88 1088.75 L 379.63 1085.25 L 377.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 286 1085.25 L 326.07 1085.26 Q 336.07 1085.27 336.07 1095.27 L 336.07 1179.53 Q 336.07 1189.53 346.07 1189.53 L 379.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 384.88 1189.5 L 377.88 1193.01 L 379.63 1189.5 L 377.88 1186.01 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 816 1085.25 L 940.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 945.88 1085.25 L 938.88 1088.75 L 940.63 1085.25 L 938.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1134 1085.25 L 1217.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1222.88 1085.25 L 1215.88 1088.75 L 1217.63 1085.25 L 1215.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 837 1189.5 L 940.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 945.88 1189.5 L 938.88 1193 L 940.63 1189.5 L 938.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1227 1189.5 L 1290.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1295.88 1189.5 L 1288.88 1193 L 1290.63 1189.5 L 1288.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1716 1189.5 L 1782.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1787.88 1189.5 L 1780.88 1193 L 1782.63 1189.5 L 1780.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2124 1189.5 L 2226.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2231.88 1189.5 L 2224.88 1193 L 2226.63 1189.5 L 2224.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2773 1189.5 L 2829.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2834.88 1189.5 L 2827.88 1193 L 2829.63 1189.5 L 2827.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2996 1189.5 L 3092.63 1189.5" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3097.88 1189.5 L 3090.88 1193 L 3092.63 1189.5 L 3090.88 1186 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1594 1085.25 L 1661.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1666.88 1085.25 L 1659.88 1088.75 L 1661.63 1085.25 L 1659.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1810 1085.25 L 1846.07 1085.26 Q 1856.07 1085.27 1866.07 1085.2 L 1894.58 1085" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1899.83 1085 L 1892.83 1088.5 L 1894.58 1085 L 1892.83 1081.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2252 1085 L 2280 1085 Q 2290 1085 2300 1085.08 L 2321.63 1085.27" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2326.88 1085.27 L 2319.88 1088.77 L 2321.63 1085.27 L 2319.88 1081.77 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2528 1085.25 L 2607.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2612.88 1085.25 L 2605.88 1088.75 L 2607.63 1085.25 L 2605.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2774 1085.25 L 2837.63 1085.25" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2842.88 1085.25 L 2835.88 1088.75 L 2837.63 1085.25 L 2835.88 1081.75 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3004 1085.25 L 3024.07 1085.26 Q 3034.07 1085.27 3044.07 1085.27 L 3057.63 1085.27" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3062.88 1085.27 L 3055.88 1088.77 L 3057.63 1085.27 L 3055.88 1081.77 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1237px; margin-left: 29px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">5. nsqd 消息通知lookupd</div></div></div></foreignObject><text x="29" y="1241" fill="#000000" font-family="source code pro" font-size="13px">5. nsqd 消息通知lookupd</text></switch></g><rect x="27" y="1257" width="133" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 126px; height: 1px; padding-top: 1287px; margin-left: 34px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">lookupLoop()</div></div></div></foreignObject><text x="34" y="1291" fill="#000000" font-family="source code pro" font-size="13px">lookupLoop()</text></switch></g><rect x="314" y="1244.5" width="467" height="85" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 460px; height: 1px; padding-top: 1287px; margin-left: 321px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">var lookupPeers []*lookupPeer<br />for _, host := range n.getOpts().NSQLookupdTCPAddresses {<br />    lookupPeer := newLookupPeer(...)<br />    lookupPeers = append(lookupPeers, lookupPeer)<br />}</div></div></div></foreignObject><text x="321" y="1291" fill="#000000" font-family="source code pro" font-size="13px">var lookupPeers []*lookupPeer...</text></switch></g><rect x="314" y="1347" width="450" height="170" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 443px; height: 1px; padding-top: 1432px; margin-left: 321px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; "><div>switch val.(type) {</div><div>case *Channel:</div><div>    channel := val.(*Channel)</div><div>    cmd = nsq.Register(channel.topicName, channel.name)</div><div>case *Topic:</div><div>    topic := val.(*Topic)</div><div>    cmd = nsq.Register(topic.name, "")</div><div>}</div><div>for _, lookupPeer := range lookupPeers {</div><div>    _, err := lookupPeer.Command(cmd)</div><div>}</div></div></div></div></foreignObject><text x="321" y="1436" fill="#000000" font-family="source code pro" font-size="13px">switch val.(type) {...</text></switch></g><path d="M 160 1287 L 307.63 1287" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 312.88 1287 L 305.88 1290.5 L 307.63 1287 L 305.88 1283.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 160 1287 L 194.07 1287 Q 204.07 1287 204.07 1297 L 204.07 1412.07 Q 204.07 1422.07 214.07 1422.06 L 305.83 1421.98" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 311.08 1421.97 L 304.09 1425.48 L 305.83 1421.98 L 304.08 1418.48 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><rect x="698" y="464.5" width="170" height="45" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 163px; height: 1px; padding-top: 487px; margin-left: 705px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">"/pub", s.doPUB</div></div></div></foreignObject><text x="705" y="491" fill="#000000" font-family="source code pro" font-size="13px">"/pub", s.doPUB</text></switch></g><path d="M 578 487 L 691.63 487" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 696.88 487 L 689.88 490.5 L 691.63 487 L 689.88 483.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 296 723 L 296 687 L 466 687 L 466 723" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 296 723 L 296 749 L 466 749 L 466 723" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 296 723 L 466 723" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="302.5" y="702">&lt;&lt;interface&gt;&gt;</text><text x="302.5" y="718">TCPHandler</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-301-728-165-26-0)" font-size="13px"><text x="302.5" y="741.5">+ Handle(net.Conn)</text></g><path d="M 2450 187.5 L 2450 161.5 L 2740 161.5 L 2740 187.5" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2450 187.5 L 2450 291.5 L 2740 291.5 L 2740 187.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2450 187.5 L 2740 187.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="2456.5" y="179.5">Topic</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2455-193-285-26-0)" font-size="13px"><text x="2456.5" y="206">- name: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2455-219-285-26-0)" font-size="13px"><text x="2456.5" y="232">- channelMap: map[string]*Channel</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2455-245-285-26-0)" font-size="13px"><text x="2456.5" y="258">- backend: BackendQueue</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2455-271-285-26-0)" font-size="13px"><text x="2456.5" y="284">- memoryMsgChan: chan</text></g><path d="M 2814 188 L 2814 162 L 3101 162 L 3101 188" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2814 188 L 2814 292 L 3101 292 L 3101 188" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2814 188 L 3101 188" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="2820.5" y="180">Channel</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2819-193-282-26-0)" font-size="13px"><text x="2820.5" y="206.5">- topicName: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2819-219-282-26-0)" font-size="13px"><text x="2820.5" y="232.5">- name: string</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2819-245-282-26-0)" font-size="13px"><text x="2820.5" y="258.5">- memoryMsgChan: chan</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-2819-271-282-26-0)" font-size="13px"><text x="2820.5" y="284.5">- clients: map[int64]Consumer</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 146px; margin-left: 1175px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; "><font face="source code pro" style="font-size: 13px">启动NSQD 服务</font></div></div></div></foreignObject><text x="1175" y="150" fill="#000000" font-family="Helvetica" font-size="12px">启动NSQD 服务</text></switch></g><path d="M 2454.06 176.97 L 2422.07 176.99 Q 2412.07 177 2412.07 187 L 2412.07 193.73 Q 2412.07 200.47 2402.07 200.48 L 2380.37 200.49" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 2375.12 200.5 L 2382.11 196.99 L 2380.37 200.49 L 2382.12 203.99 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 2814.86 176.04 L 2787 176.06 Q 2777 176.07 2777 186.07 L 2777 216.47 Q 2777 226.47 2767 226.48 L 2746.37 226.49" fill="none" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><path d="M 2741.12 226.5 L 2748.11 222.99 L 2746.37 226.49 L 2748.12 229.99 Z" fill="#1dbf97" stroke="#1dbf97" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 42px; margin-left: 97px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">NSQD 服务实现</div></div></div></foreignObject><text x="97" y="47" fill="#000000" font-family="source code pro" font-size="18px" text-anchor="middle">NSQD 服务实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>