<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="3801px" height="911px" viewBox="-0.5 -0.5 3801 911" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-04-02T14:09:55.887Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;9GwWc1bQkM4JSs7TG73K&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;PcnlUP_apkeiURy5b1Ax&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-1365-173-185-26-0"><rect x="1365" y="173" width="185" height="26"/></clipPath><clipPath id="mx-clip-1365-199-185-26-0"><rect x="1365" y="199" width="185" height="26"/></clipPath><clipPath id="mx-clip-1605-173-395-26-0"><rect x="1605" y="173" width="395" height="26"/></clipPath></defs><g><path d="M 1360 168 L 1360 142 L 1550 142 L 1550 168" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1360 168 L 1360 220 L 1550 220 L 1550 168" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1360 168 L 1550 168" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1366.5" y="160">NSQLookupd</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1365-173-185-26-0)" font-size="13px"><text x="1366.5" y="186.5">- : sync.RWMutex</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1365-199-185-26-0)" font-size="13px"><text x="1366.5" y="212.5">- DB: *RegistrationDB</text></g><path d="M 1600 168 L 1600 142 L 2000 142 L 2000 168" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1600 168 L 1600 194 L 2000 194 L 2000 168" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1600 168 L 2000 168" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="1606.5" y="160">RegistrationDB</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-1605-173-395-26-0)" font-size="13px"><text x="1606.5" y="186.5">- registrationMap: map[Registration]ProducerMap</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 132px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. lookupd 启动</div></div></div></foreignObject><text x="22" y="136" fill="#000000" font-family="source code pro" font-size="13px">1. lookupd 启动</text></switch></g><rect x="20" y="160" width="360" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 353px; height: 1px; padding-top: 190px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">nsqlookupd, err := nsqlookupd.New(opts)</div></div></div></foreignObject><text x="27" y="194" fill="#000000" font-family="source code pro" font-size="13px">nsqlookupd, err := nsqlookupd.New(opts)</text></switch></g><rect x="70" y="240" width="178" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 171px; height: 1px; padding-top: 270px; margin-left: 77px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">nsqlookupd.Main()</div></div></div></foreignObject><text x="77" y="274" fill="#000000" font-family="source code pro" font-size="13px">nsqlookupd.Main()</text></switch></g><rect x="470" y="160" width="380" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 373px; height: 1px; padding-top: 190px; margin-left: 477px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func New(opts *Options) (*NSQLookupd, error)</div></div></div></foreignObject><text x="477" y="194" fill="#000000" font-family="source code pro" font-size="13px">func New(opts *Options) (*NSQLookupd, error)</text></switch></g><rect x="990" y="156" width="270" height="68" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 263px; height: 1px; padding-top: 190px; margin-left: 997px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">l := &amp;NSQLookupd{<br />    opts: opts,<br />    DB:   NewRegistrationDB(),<br />}</div></div></div></foreignObject><text x="997" y="194" fill="#000000" font-family="source code pro" font-size="13px">l := &amp;NSQLookupd{...</text></switch></g><rect x="990" y="238" width="460" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 453px; height: 1px; padding-top: 268px; margin-left: 997px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">l.tcpListener, err = net.Listen("tcp", opts.TCPAddress)</div></div></div></foreignObject><text x="997" y="272" fill="#000000" font-family="source code pro" font-size="13px">l.tcpListener, err = net.Listen("tcp", opts.TCPAddress)</text></switch></g><rect x="990" y="310" width="480" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 473px; height: 1px; padding-top: 340px; margin-left: 997px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">l.httpListener, err = net.Listen("tcp", opts.HTTPAddress)</div></div></div></foreignObject><text x="997" y="344" fill="#000000" font-family="source code pro" font-size="13px">l.httpListener, err = net.Listen("tcp", opts.HTTPAddress)</text></switch></g><rect x="350" y="242" width="480" height="56" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 473px; height: 1px; padding-top: 270px; margin-left: 357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">tcpServer := &amp;tcpServer{ctx: ctx}<br />go protocol.TCPServer(l.tcpListener, tcpServer, l.logf)</div></div></div></foreignObject><text x="357" y="274" fill="#000000" font-family="source code pro" font-size="13px">tcpServer := &amp;tcpServer{ctx: ctx}...</text></switch></g><rect x="350" y="310" width="520" height="52" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 513px; height: 1px; padding-top: 336px; margin-left: 357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">httpServer := newHTTPServer(ctx)<br />go http_api.Serve(l.httpListener, httpServer, "HTTP", l.logf)</div></div></div></foreignObject><text x="357" y="340" fill="#000000" font-family="source code pro" font-size="13px">httpServer := newHTTPServer(ctx)...</text></switch></g><path d="M 380 190 L 463.63 190" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 468.88 190 L 461.88 193.5 L 463.63 190 L 461.88 186.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 850 190 L 983.63 190" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 988.88 190 L 981.88 193.5 L 983.63 190 L 981.88 186.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 850 190 L 890 190 Q 900 190 900 200 L 900 258 Q 900 268 910 268 L 983.63 268" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 988.88 268 L 981.88 271.5 L 983.63 268 L 981.88 264.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 850 190 L 890 190 Q 900 190 900 200 L 900 330 Q 900 340 910 340 L 983.63 340" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 988.88 340 L 981.88 343.5 L 983.63 340 L 981.88 336.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 248 270 L 343.63 270" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 348.88 270 L 341.88 273.5 L 343.63 270 L 341.88 266.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 248 270 L 260 270 Q 270 270 270 280 L 270 326 Q 270 336 280 336 L 343.63 336" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 348.88 336 L 341.88 339.5 L 343.63 336 L 341.88 332.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 390px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. http 请求处理实现</div></div></div></foreignObject><text x="22" y="394" fill="#000000" font-family="source code pro" font-size="13px">2. http 请求处理实现</text></switch></g><rect x="20" y="410.17" width="313" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 306px; height: 1px; padding-top: 440px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func newHTTPServer(ctx *Context)</div></div></div></foreignObject><text x="27" y="444" fill="#000000" font-family="source code pro" font-size="13px">func newHTTPServer(ctx *Context)</text></switch></g><rect x="433" y="501.17" width="247" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 240px; height: 1px; padding-top: 531px; margin-left: 440px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">"/lookup", s.doLookup</div></div></div></foreignObject><text x="440" y="535" fill="#000000" font-family="source code pro" font-size="13px">"/lookup", s.doLookup</text></switch></g><rect x="433" y="410.17" width="287" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 280px; height: 1px; padding-top: 440px; margin-left: 440px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">"/topic/create", s.doCreateTopic</div></div></div></foreignObject><text x="440" y="444" fill="#000000" font-family="source code pro" font-size="13px">"/topic/create", s.doCreateTopic</text></switch></g><rect x="807.5" y="410.17" width="336" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 329px; height: 1px; padding-top: 440px; margin-left: 815px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (s *httpServer) doCreateTopic(...)</div></div></div></foreignObject><text x="815" y="444" fill="#000000" font-family="source code pro" font-size="13px">func (s *httpServer) doCreateTopic(...)</text></switch></g><rect x="1290" y="408.17" width="400" height="64" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 393px; height: 1px; padding-top: 440px; margin-left: 1297px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topicName, err := reqParams.Get("topic")<br />key := Registration{"topic", topicName, ""}<br />s.ctx.nsqlookupd.DB.AddRegistration(key)</div></div></div></foreignObject><text x="1297" y="444" fill="#000000" font-family="source code pro" font-size="13px">topicName, err := reqParams.Get("topic")...</text></switch></g><rect x="1780" y="410.17" width="304" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 297px; height: 1px; padding-top: 440px; margin-left: 1787px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">AddRegistration(k Registration)</div></div></div></foreignObject><text x="1787" y="444" fill="#000000" font-family="source code pro" font-size="13px">AddRegistration(k Registration)</text></switch></g><rect x="2178" y="410.17" width="442" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 435px; height: 1px; padding-top: 440px; margin-left: 2185px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r.registrationMap[k] = make(map[string]*Producer)</div></div></div></foreignObject><text x="2185" y="444" fill="#000000" font-family="source code pro" font-size="13px">r.registrationMap[k] = make(map[string]*Producer)</text></switch></g><rect x="810" y="501.17" width="331" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 324px; height: 1px; padding-top: 531px; margin-left: 817px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (s *httpServer) doLookup(...)</div></div></div></foreignObject><text x="817" y="535" fill="#000000" font-family="source code pro" font-size="13px">func (s *httpServer) doLookup(...)</text></switch></g><rect x="1290" y="492.67" width="500" height="77" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 493px; height: 1px; padding-top: 531px; margin-left: 1297px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topicName, err := reqParams.Get("topic")<br />registration := DB.FindRegistrations("topic", topicName, "")<br />producers := DB.FindProducers("topic", topicName, "")</div></div></div></foreignObject><text x="1297" y="535" fill="#000000" font-family="source code pro" font-size="13px">topicName, err := reqParams.Get("topic")...</text></switch></g><rect x="1900" y="501.17" width="410" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 403px; height: 1px; padding-top: 531px; margin-left: 1907px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *RegistrationDB) FindRegistrations(...)</div></div></div></foreignObject><text x="1907" y="535" fill="#000000" font-family="source code pro" font-size="13px">func (r *RegistrationDB) FindRegistrations(...)</text></switch></g><rect x="2400" y="491.67" width="349" height="79" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 342px; height: 1px; padding-top: 531px; margin-left: 2407px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">k := Registration{category, key, subkey}<br />if _, ok := r.registrationMap[k]; ok {<br />    return Registrations{k}<br />}</div></div></div></foreignObject><text x="2407" y="535" fill="#000000" font-family="source code pro" font-size="13px">k := Registration{category, key, subkey}...</text></switch></g><rect x="1900" y="590.17" width="380" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 373px; height: 1px; padding-top: 620px; margin-left: 1907px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (r *RegistrationDB) FindProducers(...)</div></div></div></foreignObject><text x="1907" y="624" fill="#000000" font-family="source code pro" font-size="13px">func (r *RegistrationDB) FindProducers(...)</text></switch></g><rect x="2400" y="584.17" width="400" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 393px; height: 1px; padding-top: 620px; margin-left: 2407px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">k := Registration{category, key, subkey}<br />return ProducerMap2Slice(r.registrationMap[k])</div></div></div></foreignObject><text x="2407" y="624" fill="#000000" font-family="source code pro" font-size="13px">k := Registration{category, key, subkey}...</text></switch></g><path d="M 333 440.17 L 350 440.19 Q 360 440.2 360 450.2 L 360 521.2 Q 360 531.2 370 531.2 L 426.63 531.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 431.88 531.17 L 424.88 534.67 L 426.63 531.17 L 424.88 527.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 333 440.17 L 426.63 440.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 431.88 440.17 L 424.88 443.67 L 426.63 440.17 L 424.88 436.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 720 440.17 L 801.13 440.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 806.38 440.17 L 799.38 443.67 L 801.13 440.17 L 799.38 436.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1143.5 440.17 L 1283.63 440.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1288.88 440.17 L 1281.88 443.67 L 1283.63 440.17 L 1281.88 436.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1690 440.17 L 1773.63 440.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1778.88 440.17 L 1771.88 443.67 L 1773.63 440.17 L 1771.88 436.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2084 440.17 L 2171.63 440.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2176.88 440.17 L 2169.88 443.67 L 2171.63 440.17 L 2169.88 436.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 680 531.17 L 803.63 531.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 808.88 531.17 L 801.88 534.67 L 803.63 531.17 L 801.88 527.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1141 531.17 L 1283.63 531.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1288.88 531.17 L 1281.88 534.67 L 1283.63 531.17 L 1281.88 527.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1790 531.17 L 1893.63 531.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1898.88 531.17 L 1891.88 534.67 L 1893.63 531.17 L 1891.88 527.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2310 531.17 L 2393.63 531.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2398.88 531.17 L 2391.88 534.67 L 2393.63 531.17 L 2391.88 527.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1790 531.17 L 1820 531.19 Q 1830 531.2 1830 541.2 L 1830 610.2 Q 1830 620.2 1840 620.2 L 1893.63 620.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1898.88 620.17 L 1891.88 623.67 L 1893.63 620.17 L 1891.88 616.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2280 620.17 L 2393.63 620.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2398.88 620.17 L 2391.88 623.67 L 2393.63 620.17 L 2391.88 616.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 582px; margin-left: 22px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">3. tcp 请求处理实现</div></div></div></foreignObject><text x="22" y="586" fill="#000000" font-family="source code pro" font-size="13px">3. tcp 请求处理实现</text></switch></g><rect x="20" y="600.17" width="214" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 207px; height: 1px; padding-top: 630px; margin-left: 27px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func TCPServer(...)</div></div></div></foreignObject><text x="27" y="634" fill="#000000" font-family="source code pro" font-size="13px">func TCPServer(...)</text></switch></g><rect x="354" y="591.67" width="346" height="77" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 339px; height: 1px; padding-top: 630px; margin-left: 361px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">for {<br />    clientConn, err := listener.Accept()<br />    go handler.Handle(clientConn)<br />}</div></div></div></foreignObject><text x="361" y="634" fill="#000000" font-family="source code pro" font-size="13px">for {...</text></switch></g><path d="M 380 670 L 380 702 Q 380 712 386.82 712 L 393.63 712" fill="none" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 398.88 712 L 391.88 715.5 L 393.63 712 L 391.88 708.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="400" y="682" width="420" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 413px; height: 1px; padding-top: 712px; margin-left: 407px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (p *tcpServer) Handle(clientConn net.Conn)</div></div></div></foreignObject><text x="407" y="716" fill="#000000" font-family="source code pro" font-size="13px">func (p *tcpServer) Handle(clientConn net.Conn)</text></switch></g><rect x="894.5" y="676" width="349.5" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 343px; height: 1px; padding-top: 712px; margin-left: 902px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">prot = &amp;LookupProtocolV1{ctx: p.ctx}<br />err = prot.IOLoop(clientConn)</div></div></div></foreignObject><text x="902" y="716" fill="#000000" font-family="source code pro" font-size="13px">prot = &amp;LookupProtocolV1{ctx: p.ctx}...</text></switch></g><path d="M 909.88 750.02 L 909.89 782 Q 909.9 792 919.9 792 L 933.63 792" fill="none" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><path d="M 938.88 792 L 931.88 795.5 L 933.63 792 L 931.88 788.5 Z" fill="#019ed5" stroke="#019ed5" stroke-miterlimit="10" pointer-events="none"/><rect x="940" y="762" width="420" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 413px; height: 1px; padding-top: 792px; margin-left: 947px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func (p *LookupProtocolV1) IOLoop(conn net.Conn)</div></div></div></foreignObject><text x="947" y="796" fill="#000000" font-family="source code pro" font-size="13px">func (p *LookupProtocolV1) IOLoop(conn net.Conn)</text></switch></g><rect x="1430" y="720" width="444" height="144" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 437px; height: 1px; padding-top: 792px; margin-left: 1437px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">client := NewClientV1(conn)<br />reader := bufio.NewReader(client)<br />for {<br />    line, err = reader.ReadString('\n')<br />    params := strings.Split(line, " ")<br />    response, err = p.Exec(client, reader, params)<br />    _, err = protocol.SendResponse(client, response)<br />}</div></div></div></foreignObject><text x="1437" y="796" fill="#000000" font-family="source code pro" font-size="13px">client := NewClientV1(conn)...</text></switch></g><rect x="1964.5" y="690" width="304" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 297px; height: 1px; padding-top: 720px; margin-left: 1972px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">func NewClientV1(conn net.Conn)</div></div></div></foreignObject><text x="1972" y="724" fill="#000000" font-family="source code pro" font-size="13px">func NewClientV1(conn net.Conn)</text></switch></g><rect x="2334.5" y="689.5" width="180" height="61" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 173px; height: 1px; padding-top: 720px; margin-left: 2342px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">return &amp;ClientV1{<br />    Conn: conn,<br />}</div></div></div></foreignObject><text x="2342" y="724" fill="#000000" font-family="source code pro" font-size="13px">return &amp;ClientV1{...</text></switch></g><rect x="1964" y="800" width="120" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 113px; height: 1px; padding-top: 830px; margin-left: 1971px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">Exec(...)</div></div></div></foreignObject><text x="1971" y="834" fill="#000000" font-family="source code pro" font-size="13px">Exec(...)</text></switch></g><rect x="2189" y="770" width="420" height="120" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 413px; height: 1px; padding-top: 830px; margin-left: 2196px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">switch params[0] {<br />case "IDENTIFY":<br />    return p.IDENTIFY(client, reader, params[1:])<br />case "REGISTER":<br />    return p.REGISTER(client, reader, params[1:])<br />}</div></div></div></foreignObject><text x="2196" y="834" fill="#000000" font-family="source code pro" font-size="13px">switch params[0] {...</text></switch></g><rect x="2700" y="690" width="140" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 133px; height: 1px; padding-top: 720px; margin-left: 2707px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">IDENTIFY(...)</div></div></div></foreignObject><text x="2707" y="724" fill="#000000" font-family="source code pro" font-size="13px">IDENTIFY(...)</text></switch></g><rect x="2890" y="656.17" width="490" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 483px; height: 1px; padding-top: 710px; margin-left: 2897px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">_, err = io.ReadFull(reader, body)<br />peerInfo := PeerInfo{id: client.RemoteAddr().String()}<br />err = json.Unmarshal(body, &amp;peerInfo)<br />client.peerInfo = &amp;peerInfo<br />key := Registration{"client", "", ""}<br />DB.AddProducer(key, &amp;Producer{peerInfo: client.peerInfo})</div></div></div></foreignObject><text x="2897" y="714" fill="#000000" font-family="source code pro" font-size="13px">_, err = io.ReadFull(reader, body)...</text></switch></g><rect x="2700" y="800" width="150" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 143px; height: 1px; padding-top: 830px; margin-left: 2707px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">REGISTER(...)</div></div></div></foreignObject><text x="2707" y="834" fill="#000000" font-family="source code pro" font-size="13px">REGISTER(...)</text></switch></g><rect x="2890" y="776" width="490" height="108" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 483px; height: 1px; padding-top: 830px; margin-left: 2897px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">topic, channel, err := getTopicChan("REGISTER", params)<br />key := Registration{"channel", topic, channel}<br />DB.AddProducer(key, &amp;Producer{peerInfo: client.peerInfo})<br />key := Registration{"topic", topic, ""}<br />DB.AddProducer(key, &amp;Producer{peerInfo: client.peerInfo})</div></div></div></foreignObject><text x="2897" y="834" fill="#000000" font-family="source code pro" font-size="13px">topic, channel, err := getTopicChan("REGISTER", params)...</text></switch></g><rect x="3430" y="680.17" width="340" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 333px; height: 1px; padding-top: 710px; margin-left: 3437px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">AddProducer(k Registration, p *Producer)</div></div></div></foreignObject><text x="3437" y="714" fill="#000000" font-family="source code pro" font-size="13px">AddProducer(k Registration, p *Producer)</text></switch></g><rect x="3500" y="756" width="280" height="72" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 273px; height: 1px; padding-top: 792px; margin-left: 3507px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">producers := r.registrationMap[k]<br />producers[p.peerInfo.id] = p</div></div></div></foreignObject><text x="3507" y="796" fill="#000000" font-family="source code pro" font-size="13px">producers := r.registrationMap[k]...</text></switch></g><path d="M 234 630.17 L 347.63 630.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 352.88 630.17 L 345.88 633.67 L 347.63 630.17 L 345.88 626.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 820 712 L 888.13 712" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 893.38 712 L 886.38 715.5 L 888.13 712 L 886.38 708.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1360 792 L 1423.63 792" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1428.88 792 L 1421.88 795.5 L 1423.63 792 L 1421.88 788.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1874 792 L 1909.3 792 Q 1919.3 792 1919.3 782 L 1919.3 730 Q 1919.3 720 1929.3 720 L 1958.13 720" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1963.38 720 L 1956.38 723.5 L 1958.13 720 L 1956.38 716.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2268.5 720 L 2328.13 720" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2333.38 720 L 2326.38 723.5 L 2328.13 720 L 2326.38 716.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1874 792 L 1910 792 Q 1920 792 1920 802 L 1920 820 Q 1920 830 1930 830 L 1957.63 830" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 1962.88 830 L 1955.88 833.5 L 1957.63 830 L 1955.88 826.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2084 830 L 2182.63 830" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2187.88 830 L 2180.88 833.5 L 2182.63 830 L 2180.88 826.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2609 830 L 2640 830 Q 2650 830 2650 820 L 2650 730 Q 2650 720 2660 720 L 2693.63 720" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2698.88 720 L 2691.88 723.5 L 2693.63 720 L 2691.88 716.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2840 720 L 2883.63 720" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2888.88 720 L 2881.88 723.5 L 2883.63 720 L 2881.88 716.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2609 830 L 2660 830 Q 2670 830 2680 830 L 2693.63 830" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2698.88 830 L 2691.88 833.5 L 2693.63 830 L 2691.88 826.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2850 830 L 2883.63 830" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 2888.88 830 L 2881.88 833.5 L 2883.63 830 L 2881.88 826.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3380 710.17 L 3423.63 710.17" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3428.88 710.17 L 3421.88 713.67 L 3423.63 710.17 L 3421.88 706.67 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3471.82 741.97 L 3471.8 782 Q 3471.8 792 3481.8 792 L 3493.63 792" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 3498.88 792 L 3491.88 795.5 L 3493.63 792 L 3491.88 788.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 30px; margin-left: 90px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; "><font face="source code pro" style="font-size: 18px">lookupd 实现</font></div></div></div></foreignObject><text x="90" y="34" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">lookupd 实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>