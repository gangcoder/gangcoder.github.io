<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1271px" height="781px" viewBox="-0.5 -0.5 1271 781" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-03T01:11:45.268Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/12.6.5 Chrome/80.0.3987.86 Electron/8.0.0 Safari/537.36&quot; etag=&quot;zgseUr1heGkN425ppKUI&quot; version=&quot;12.6.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;OOPMt5_gRr6uG-YKwvPP&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-945-194-295-26-0"><rect x="945" y="194" width="295" height="26"/></clipPath><clipPath id="mx-clip-945-220-295-26-0"><rect x="945" y="220" width="295" height="26"/></clipPath><clipPath id="mx-clip-945-246-295-26-0"><rect x="945" y="246" width="295" height="26"/></clipPath><clipPath id="mx-clip-945-272-295-26-0"><rect x="945" y="272" width="295" height="26"/></clipPath></defs><g><path d="M 940 189 L 940 163 L 1240 163 L 1240 189" fill="#1dbf97" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 940 189 L 940 293 L 1240 293 L 1240 189" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 940 189 L 1240 189" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="source code pro" font-size="13px"><text x="946.5" y="181">Router</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-945-194-295-26-0)" font-size="13px"><text x="946.5" y="207.5">- routingTable: map[string]Handler</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-945-220-295-26-0)" font-size="13px"><text x="946.5" y="233.5">- httpForwarder: Handler</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-945-246-295-26-0)" font-size="13px"><text x="946.5" y="259.5">- httpHandler: http.Handler</text></g><g fill="#000000" font-family="source code pro" clip-path="url(#mx-clip-945-272-295-26-0)" font-size="13px"><text x="946.5" y="285.5">- catchAllNoTLS: Handler</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 163px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">1. TCP 服务接口</div></div></div></foreignObject><text x="32" y="167" fill="#000000" font-family="source code pro" font-size="13px">1. TCP 服务接口</text></switch></g><rect x="30" y="181" width="259" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 252px; height: 1px; padding-top: 211px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">ServeTCP(conn WriteCloser)</div></div></div></foreignObject><text x="37" y="215" fill="#000000" font-family="source code pro" font-size="13px">ServeTCP(conn WriteCloser)</text></switch></g><rect x="389" y="163" width="461" height="96" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 454px; height: 1px; padding-top: 211px; margin-left: 396px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">if r.catchAllNoTLS != nil &amp;&amp; len(r.routingTable) == 0 {<br />    r.catchAllNoTLS.ServeTCP(conn)<br />    return<br />}</div></div></div></foreignObject><text x="396" y="215" fill="#000000" font-family="source code pro" font-size="13px">if r.catchAllNoTLS != nil &amp;&amp; len(r.routingTable) == 0 {...</text></switch></g><rect x="389" y="270" width="479" height="132" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 472px; height: 1px; padding-top: 336px; margin-left: 396px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">if !tls {<br />    switch {<br />    case r.httpForwarder != nil:<br />        r.httpForwarder.ServeTCP(r.GetConn(conn, peeked))<br />    }<br />    return<br />}</div></div></div></foreignObject><text x="396" y="340" fill="#000000" font-family="source code pro" font-size="13px">if !tls {...</text></switch></g><rect x="390" y="420" width="470" height="132" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 463px; height: 1px; padding-top: 486px; margin-left: 397px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">serverName = strings.ToLower(serverName)<br />if r.routingTable != nil &amp;&amp; serverName != "" {<br />    if target, ok := r.routingTable[serverName]; ok {<br />        target.ServeTCP(r.GetConn(conn, peeked))<br />        return<br />    }<br />}</div></div></div></foreignObject><text x="397" y="490" fill="#000000" font-family="source code pro" font-size="13px">serverName = strings.ToLower(serverName)...</text></switch></g><rect x="389" y="570" width="471" height="84" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 464px; height: 1px; padding-top: 612px; margin-left: 396px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">if r.httpsForwarder != nil {<br />    r.httpsForwarder.ServeTCP(r.GetConn(conn, peeked))<br />}</div></div></div></foreignObject><text x="396" y="616" fill="#000000" font-family="source code pro" font-size="13px">if r.httpsForwarder != nil {...</text></switch></g><path d="M 289 211 L 382.63 211" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 387.88 211 L 380.88 214.5 L 382.63 211 L 380.88 207.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 289 211 L 320 211 Q 330 211 330 221 L 330 326 Q 330 336 340 336 L 382.63 336" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 387.88 336 L 380.88 339.5 L 382.63 336 L 380.88 332.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 289 211 L 320 211 Q 330 211 330 221 L 330 476 Q 330 486 340 486 L 383.63 486" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 388.88 486 L 381.88 489.5 L 383.63 486 L 381.88 482.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 289 211 L 320 211 Q 330 211 330 221 L 330 602 Q 330 612 340 612 L 382.63 612" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 387.88 612 L 380.88 615.5 L 382.63 612 L 380.88 608.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 670px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">2. 添加host 处理handler</div></div></div></foreignObject><text x="32" y="674" fill="#000000" font-family="source code pro" font-size="13px">2. 添加host 处理handler</text></switch></g><rect x="30" y="690" width="385" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 378px; height: 1px; padding-top: 720px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">AddRoute(sniHost string, target Handler)</div></div></div></foreignObject><text x="37" y="724" fill="#000000" font-family="source code pro" font-size="13px">AddRoute(sniHost string, target Handler)</text></switch></g><rect x="515" y="690" width="425" height="60" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 418px; height: 1px; padding-top: 720px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 13px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: normal; word-wrap: normal; ">r.routingTable[strings.ToLower(sniHost)] = target</div></div></div></foreignObject><text x="522" y="724" fill="#000000" font-family="source code pro" font-size="13px">r.routingTable[strings.ToLower(sniHost)] = target</text></switch></g><path d="M 415 720 L 508.63 720" fill="none" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><path d="M 513.88 720 L 506.88 723.5 L 508.63 720 L 506.88 716.5 Z" fill="#fe4365" stroke="#fe4365" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 45px; margin-left: 32px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 18px; font-family: source code pro; color: #000000; line-height: 1.2; pointer-events: none; white-space: nowrap; ">Traefix Tcp 路由分发实现</div></div></div></foreignObject><text x="32" y="50" fill="#000000" font-family="source code pro" font-size="18px">Traefix Tcp 路由分发实现</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>